<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.91.2"><link rel=canonical type=text/html href=/docs/deployment/>
<link rel=alternate type=application/rss+xml href=/docs/deployment/index.xml>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Agency Deployment | Findy Agency</title>
<meta name=description content="Findy Agency documentation"><meta property="og:title" content="Agency Deployment">
<meta property="og:description" content="Instructions how to deploy Agency.
">
<meta property="og:type" content="website">
<meta property="og:url" content="/docs/deployment/"><meta property="og:site_name" content="Findy Agency">
<meta itemprop=name content="Agency Deployment">
<meta itemprop=description content="Instructions how to deploy Agency.
"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Agency Deployment">
<meta name=twitter:description content="Instructions how to deploy Agency.
">
<link rel=preload href=/scss/main.min.77ad8086257c5b04aec72128f0eebde3c7c6696b921b68c53e5e0d3f187d0a84.css as=style>
<link href=/scss/main.min.77ad8086257c5b04aec72128f0eebde3c7c6696b921b68c53e5e0d3f187d0a84.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Findy Agency</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/docs/><span class=active>Documentation</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/blog/><span>Blog</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block">
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div>
<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href=/docs/deployment/>Return to the regular view of this page</a>.
</p>
</div>
<h1 class=title>Agency Deployment</h1>
<div class=lead>Instructions how to deploy Agency.</div>
<ul>
<li>1: <a href=#pg-1b67f585d5874fa5122f8837cc5b1eda>Configuration</a></li>
</ul>
<div class=content>
<p>The documentation present <a href=./configuration>an overview</a> of Agency deployment architecture and configuration.</p>
<p>Examples and deployment scripts can be found in <a href=https://github.com/findy-network/findy-agent-infra>findy-agent-infra repository</a>:</p>
<ul>
<li><a href=https://github.com/findy-network/findy-agent-infra/tree/master/aws-ecs#findy-agency-deployment-to-aws-ecs>AWS deployment with Cloudfront, S3 and ECS</a></li>
<li><a href=https://github.com/findy-network/findy-agent-infra#using-docker-compose>Localhost deployment with docker-compose and von-network</a></li>
</ul>
<p>Also the development environment setup demonstrates how agency services can interact with each other:</p>
<ul>
<li><a href=https://github.com/findy-network/findy-wallet-pwa/tree/dev/tools/env#agency-setup-for-local-development>Localhost development environment setup</a></li>
</ul>
</div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-1b67f585d5874fa5122f8837cc5b1eda>1 - Configuration</h1>
<div class=lead>Configuration for agency deployment.</div>
<div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:629px>
<img class=card-img-top src=/docs/deployment/configuration/deployment_hu67f415b8019b0c239da86fb80f917bcf_403739_675x675_fit_catmullrom_3.png width=619 height=675>
<div class="card-body px-0 pt-2 pb-0">
<p class=card-text>
<em>Overall Findy Agency Deployment Architecture</em>
</p>
</div>
</div>
<h2 id=internet-facing-reverse-proxy>Internet-facing reverse proxy</h2>
<p>Nginx, AWS load balancer etc. can work as a reverse proxy. It is recommended to use single domain for request routing to avoid hassle with FIDO2 origin requirements and CORS.</p>
<h3 id=port-443>Port 443</h3>
<table>
<thead>
<tr>
<th>Path</th>
<th>Target</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>/</td>
<td>pwa</td>
<td>Static html</td>
</tr>
<tr>
<td>/query</td>
<td>vault</td>
<td>GQL queries from PWA. Websocket support needed.</td>
</tr>
<tr>
<td>/register, /login</td>
<td>auth</td>
<td>Webauthn requires HTTPS. Domain needs to match with PWA.</td>
</tr>
<tr>
<td>/a2a</td>
<td>agency</td>
<td>Endpoint can be set with the agency&rsquo;s start up flag.</td>
</tr>
</tbody>
</table>
<h3 id=port-50051>Port 50051</h3>
<p>Agency gRPC interface communication.</p>
<p><strong>Note:</strong> Currently also all internal microservices assume gRPC SSL/TLS communication. Unencrypted communication should be enabled within private network in the future.</p>
<h2 id=findy-agent>findy-agent</h2>
<p>Sources and more documentation in repository <a href=https://github.com/findy-network/findy-agent>findy-agent</a></p>
<p><a href=https://github.com/findy-network/findy-agent/pkgs/container/findy-agent>Docker image registry in GitHub Packages</a>.</p>
<h3 id=settings>Settings</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Example</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FCLI_IMPORT_WALLET_FILE</code></td>
<td><code>/steward.exported</code></td>
<td><code>/steward.exported</code></td>
<td>File path to steward wallet to import</td>
</tr>
<tr>
<td><code>FCLI_IMPORT_WALLET_NAME</code></td>
<td><code>steward</code></td>
<td><code>steward</code></td>
<td>Steward wallet name</td>
</tr>
<tr>
<td><code>FCLI_IMPORT_WALLET_FILE_KEY</code></td>
<td><code>import-indy-key</code></td>
<td></td>
<td>Key to wallet file to import</td>
</tr>
<tr>
<td><code>FCLI_IMPORT_WALLET_KEY</code>, <code>FCLI_AGENCY_STEWARD_WALLET_KEY</code></td>
<td><code>valid-indy-key</code></td>
<td></td>
<td>Steward wallet key</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_STEWARD_DID</code></td>
<td><code>Th7MpTaRZVRYnPiabds81Y</code></td>
<td></td>
<td>Steward DID</td>
</tr>
<tr>
<td><code>FCLI_POOL_GENESIS_TXN_FILE</code></td>
<td><code>/genesis_transactions</code></td>
<td><code>/genesis_transactions</code></td>
<td>Ledger genesis file path</td>
</tr>
<tr>
<td><code>FCLI_POOL_NAME</code>, <code>FCLI_AGENCY_POOL_NAME</code></td>
<td><code>findy</code></td>
<td><code>findy</code></td>
<td>Ledger pool name</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_HOST_ADDRESS</code></td>
<td><code>agency.example.com</code></td>
<td><code>localhost</code></td>
<td>Host address as seen from internet</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_HOST_PORT</code></td>
<td><code>80</code></td>
<td><code>8080</code></td>
<td>Host port as seen from internet</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_SERVER_PORT</code></td>
<td><code>8080</code></td>
<td><code>8080</code></td>
<td>Server port in local network</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_PSM_DATABASE_FILE</code></td>
<td><code>/root/findy.bolt</code></td>
<td><code>/root/findy.bolt</code></td>
<td>PSM database file path</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_REGISTER_FILE</code></td>
<td><code>/root/findy.json</code></td>
<td><code>/root/findy.json</code></td>
<td>Handshake register file path</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_HOST_SCHEME</code></td>
<td><code>https</code></td>
<td><code>http</code></td>
<td>Scheme of the host&rsquo;s url address</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_ENCLAVE_KEY</code></td>
<td><code>0ADF..00DCAE</code></td>
<td>""</td>
<td>Secure enclave for wallet keys</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_ENCLAVE_PATH</code></td>
<td><code>findy-enclave.bolt</code></td>
<td><code>~/.indy_client/enclave.bolt</code></td>
<td>Secure enclave&rsquo;s filename</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_GRPC</code></td>
<td><code>true</code></td>
<td><code>true</code></td>
<td>Whether to enable gRPC service or not</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_GRPC_CERT_PATH</code></td>
<td><code>/cert</code></td>
<td><code>src/github.com/findy-network/findy-common-go/cert</code></td>
<td>File path to gRPC client and server certificates*</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_GRPC_JWT_SECRET</code></td>
<td><code>randomstring</code></td>
<td></td>
<td>JWT key for token validation</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_GRPC_PORT</code></td>
<td><code>50051</code></td>
<td><code>50051</code></td>
<td>gRPC interface port</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_ADMIN_ID</code></td>
<td><code>root039499</code></td>
<td><code>findy-root</code></td>
<td>Agency API user ID which is to authorization</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_ENCLAVE_BACKUP</code></td>
<td><code>~/backups/enclave.bolt.bak</code></td>
<td>""</td>
<td>Full file name template for enclave backup file</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_ENCLAVE_BACKUP_TIME</code></td>
<td><code>04:00</code></td>
<td>""</td>
<td>Time of day when enclave backup is started</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_WALLET_BACKUP</code></td>
<td><code>~/wallet/backups</code></td>
<td>""</td>
<td>Path for wallet backups</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_WALLET_BACKUP_TIME</code></td>
<td><code>05:00</code></td>
<td>""</td>
<td>Time of day when when wallet backup is started</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_REGISTER_BACKUP</code></td>
<td><code>~/backups/findy.json.bak</code></td>
<td>""</td>
<td>Full file name template for register backup file</td>
</tr>
<tr>
<td><code>FCLI_AGENCY_REGISTER_BACKUP_INTERVAL</code></td>
<td><code>20m:30s</code></td>
<td><code>12h</code></td>
<td>Time interval between backup starts</td>
</tr>
</tbody>
</table>
<p>*Cert path is the root. Both <code>server</code> and <code>client</code> certificates needs be in this folder in their own separated folders named accordingly: <code>server</code> and <code>client</code>.</p>
<h3 id=configuration-files>Configuration files</h3>
<ul>
<li>Steward wallet</li>
<li>Genesis transactions</li>
<li>gRPC client certificate + key (if TLS termination not handled by reverse proxy)</li>
<li>gRPC server certificate + key (if TLS termination not handled by reverse proxy)</li>
</ul>
<h3 id=data-storage-file-system>Data storage (file system)</h3>
<ul>
<li><strong>Handshake register</strong> (has backup capability): Text file (JSON) for onboarded agent ids</li>
<li><strong>PSM database</strong>: <em>Bolt</em> db for protocol state machine data</li>
<li><strong>Enclave</strong> (has backup capability): <em>Bolt</em> db for wallet key data</li>
<li><strong>Indy wallets</strong> (has backup capability): <em>SQLite</em> db for wallet data
<ul>
<li>in backup recovery wallet must be imported to system with indy SDK API call</li>
</ul>
</li>
</ul>
<h2 id=findy-agent-auth-fido2>findy-agent-auth (FIDO2)</h2>
<p>Sources and more documentation in repository <a href=https://github.com/findy-network/findy-agent-auth>findy-agent-auth</a></p>
<p><a href=https://github.com/findy-network/findy-agent-auth/pkgs/container/findy-agent-auth>Docker image registry in GitHub Packages</a>.</p>
<h3 id=settings-1>Settings</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Example</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--port</code></td>
<td><code>8888</code></td>
<td></td>
<td>Port for auth service</td>
</tr>
<tr>
<td><code>--agency</code></td>
<td><code>localhost</code></td>
<td></td>
<td>Agency gRPC service host</td>
</tr>
<tr>
<td><code>--gport</code></td>
<td><code>50051</code></td>
<td><code>50051</code></td>
<td>Agency gRPC service port</td>
</tr>
<tr>
<td><code>--domain</code></td>
<td><code>agency.example.com</code></td>
<td></td>
<td>Site domain name</td>
</tr>
<tr>
<td><code>--origin</code></td>
<td><code>https://agency.example.com</code></td>
<td></td>
<td>Request origin URL</td>
</tr>
<tr>
<td><code>--jwt-secret</code></td>
<td><code>randomstring</code></td>
<td></td>
<td>JWT key for access token generation</td>
</tr>
<tr>
<td><code>-sec-file</code></td>
<td><code>fido-enclave.bolt</code></td>
<td></td>
<td>sec enclave file name</td>
</tr>
<tr>
<td><code>-sec-key</code></td>
<td><code>0A0834BF...DFEA</code></td>
<td></td>
<td>sec enclave master encrypt key</td>
</tr>
<tr>
<td><code>-admin</code></td>
<td><code>findy-03029394</code></td>
<td><code>findy-root</code></td>
<td>agency admin id</td>
</tr>
<tr>
<td><code>-cert-path</code></td>
<td><code>/cert</code></td>
<td>""</td>
<td>gRPC cert root folder</td>
</tr>
<tr>
<td><code>-sec-backup-file</code></td>
<td><code>~/backups/fido-enclave.bolt.bak</code></td>
<td>""</td>
<td>Full file name template for enclave backup file</td>
</tr>
<tr>
<td><code> -sec-backup-interval</code></td>
<td><code>12</code></td>
<td><code>24</code></td>
<td>Time interval between backup checks</td>
</tr>
</tbody>
</table>
<h3 id=configuration-files-1>Configuration files</h3>
<ul>
<li>gRPC client certificate + key</li>
<li>gRPC server certificate</li>
</ul>
<h3 id=data-storage-file-system-1>Data storage (file system)</h3>
<ul>
<li><strong>FIDO enclave</strong> it&rsquo;s key/value database and encrypted by <code>enclave-key</code> which should be transferred as <em>an important secret</em> to the app.
<ul>
<li><em>Bolt</em> db for user data</li>
<li>Uses <em>file system</em> for data storage and backups as well</li>
<li>a DB is a single file</li>
</ul>
</li>
</ul>
<h2 id=findy-agent-vault>findy-agent-vault</h2>
<p>Sources and more documentation in repository <a href=https://github.com/findy-network/findy-agent-vault>findy-agent-vault</a>.</p>
<p><a href=https://github.com/findy-network/findy-agent-vault/pkgs/container/findy-agent-vault>Docker image registry in GitHub Packages</a>.</p>
<h3 id=settings-2>Settings</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Example</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FAV_SERVER_PORT</code></td>
<td><code>8085</code></td>
<td><code>8085</code></td>
<td>Port for vault service</td>
</tr>
<tr>
<td><code>FAV_JWT_KEY</code></td>
<td><code>randomstring</code></td>
<td></td>
<td>JWT key for access token validation</td>
</tr>
<tr>
<td><code>FAV_DB_HOST</code></td>
<td><code>xxx.rds.amazonaws.com</code></td>
<td></td>
<td>Postgres db host address</td>
</tr>
<tr>
<td><code>FAV_DB_PORT</code></td>
<td><code>5432</code></td>
<td><code>5432</code></td>
<td>Postgres db port</td>
</tr>
<tr>
<td><code>FAV_DB_PASSWORD</code></td>
<td><code>db-password</code></td>
<td></td>
<td>Postgres db password</td>
</tr>
<tr>
<td><code>FAV_AGENCY_HOST</code></td>
<td><code>localhost</code></td>
<td><code>localhost</code></td>
<td>Agency gRPC server host</td>
</tr>
<tr>
<td><code>FAV_AGENCY_PORT</code></td>
<td><code>50051</code></td>
<td><code>50051</code></td>
<td>Agency gRPC server port</td>
</tr>
<tr>
<td><code>FAV_AGENCY_GRPC_CERT_PATH</code></td>
<td><code>/cert</code></td>
<td></td>
<td>Agency gRPC certificate path</td>
</tr>
</tbody>
</table>
<h3 id=configuration-files-2>Configuration files</h3>
<ul>
<li>gRPC client certificate + key</li>
<li>gRPC server certificate</li>
</ul>
<h3 id=data-storage-postgres>Data storage (postgres)</h3>
<ul>
<li><strong>Database</strong>
<ul>
<li><em>Postgres</em> (e.g. AWS RDS)</li>
<li><strong>Note</strong>: Already on first start, vault service expects that the database called <code>vault</code>exists in the db instance</li>
</ul>
</li>
</ul>
<h2 id=findy-wallet-pwa>findy-wallet-pwa</h2>
<p>Sources and more documentation in repository <a href=https://github.com/findy-network/findy-wallet-pwa>findy-wallet-pwa</a></p>
<h3 id=settings-buildtime>Settings (buildtime)</h3>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Example</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>REACT_APP_GQL_HOST</code></td>
<td><code>agency.example.com</code></td>
<td><code>localhost:8085</code></td>
<td>Agency vault service host address</td>
</tr>
<tr>
<td><code>REACT_APP_AUTH_HOST</code></td>
<td><code>agency.example.com</code></td>
<td><code>localhost:8088</code></td>
<td>Agency auth service host address</td>
</tr>
<tr>
<td><code>REACT_APP_HTTP_SCHEME</code></td>
<td><code>https</code></td>
<td><code>http</code></td>
<td>HTTP URL scheme</td>
</tr>
<tr>
<td><code>REACT_APP_WS_SCHEME</code></td>
<td><code>wss</code></td>
<td><code>ws</code></td>
<td>Websocket URL scheme</td>
</tr>
</tbody>
</table>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/findy-network aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 The Findy Agency Authors All Rights Reserved</small>
<p class=mt-2><a href=/about/>About Findy Agency</a></p>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity=sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK crossorigin=anonymous></script>
<script src=/js/deflate.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css integrity=sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5 crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js integrity=sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body,null)></script>
<script src=/js/main.min.758c0b1476eb0de973b63d0030f104f41a6eb3afb9908681605af4a48eb73018.js integrity="sha256-dYwLFHbrDelztj0AMPEE9Bpus6+5kIaBYFr0pI63MBg=" crossorigin=anonymous></script>
</body>
</html>