<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Test Coverage Beyond Unit Testing | Findy Agency</title>
<meta name=description content="Automated testing is like having an extra member in your team, a shining knight against regression. Test coverage measurements and automatic test coverage monitoring help the team keep the knight shiny, i.e., automated test sets in good shape. Traditionally, we have measured the coverage for unit tests, but thorough CI pipelines also include other types of testing. Go has recently introduced new tooling that allows us to measure the test coverage for application tests and thus improve our capabilities for keeping our automated tests in shape automatically."><meta property="og:url" content="https://findy-network.github.io/blog/2023/11/16/test-coverage-beyond-unit-testing/"><meta property="og:site_name" content="Findy Agency"><meta property="og:title" content="Test Coverage Beyond Unit Testing"><meta property="og:description" content="Automated testing is like having an extra member in your team, a shining knight against regression. Test coverage measurements and automatic test coverage monitoring help the team keep the knight shiny, i.e., automated test sets in good shape. Traditionally, we have measured the coverage for unit tests, but thorough CI pipelines also include other types of testing. Go has recently introduced new tooling that allows us to measure the test coverage for application tests and thus improve our capabilities for keeping our automated tests in shape automatically."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-11-16T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-16T00:00:00+00:00"><meta property="og:image" content="https://findy-network.github.io/blog/2023/11/16/test-coverage-beyond-unit-testing/cover-knight.png"><meta itemprop=name content="Test Coverage Beyond Unit Testing"><meta itemprop=description content="Automated testing is like having an extra member in your team, a shining knight against regression. Test coverage measurements and automatic test coverage monitoring help the team keep the knight shiny, i.e., automated test sets in good shape. Traditionally, we have measured the coverage for unit tests, but thorough CI pipelines also include other types of testing. Go has recently introduced new tooling that allows us to measure the test coverage for application tests and thus improve our capabilities for keeping our automated tests in shape automatically."><meta itemprop=datePublished content="2023-11-16T00:00:00+00:00"><meta itemprop=dateModified content="2023-11-16T00:00:00+00:00"><meta itemprop=wordCount content="969"><meta itemprop=image content="https://findy-network.github.io/blog/2023/11/16/test-coverage-beyond-unit-testing/cover-knight.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://findy-network.github.io/blog/2023/11/16/test-coverage-beyond-unit-testing/cover-knight.png"><meta name=twitter:title content="Test Coverage Beyond Unit Testing"><meta name=twitter:description content="Automated testing is like having an extra member in your team, a shining knight against regression. Test coverage measurements and automatic test coverage monitoring help the team keep the knight shiny, i.e., automated test sets in good shape. Traditionally, we have measured the coverage for unit tests, but thorough CI pipelines also include other types of testing. Go has recently introduced new tooling that allows us to measure the test coverage for application tests and thus improve our capabilities for keeping our automated tests in shape automatically."><link rel=preload href=/scss/main.min.c7fba8d75c695e2a7cf37f10b188552511714d4c1645c16af7e24f7cc964a002.css as=style><link href=/scss/main.min.c7fba8d75c695e2a7cf37f10b188552511714d4c1645c16af7e24f7cc964a002.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Findy Agency</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/blog/><span>Blog</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="Findy Agency Blog" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240424the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools-li><a href=/blog/2024/04/24/the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools/ title="The Swiss Army Knife for the Agency Project, Part 3: Other GitHub Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240424the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools><span>Other GitHub Tools</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240423the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github-li><a href=/blog/2024/04/23/the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github/ title="The Swiss Army Knife for the Agency Project, Part 2: Release Management with GitHub" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240423the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github><span>Release Management with GitHub</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions-li><a href=/blog/2024/04/22/the-swiss-army-knife-for-the-agency-project-part-1-github-actions/ title="The Swiss Army Knife for the Agency Project, Part 1: GitHub Actions" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions><span>GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240411issuing-chatbot-li><a href=/blog/2024/04/11/issuing-chatbot/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240411issuing-chatbot><span>Issuing Chatbot</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240406i-want-mdl-li><a href=/blog/2024/04/06/i-want-mdl/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240406i-want-mdl><span>I want mDL!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240327managing-github-branch-protections-li><a href=/blog/2024/03/27/managing-github-branch-protections/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240327managing-github-branch-protections><span>Managing GitHub Branch Protections</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240105path-to-passwordless-li><a href=/blog/2024/01/05/path-to-passwordless/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240105path-to-passwordless><span>Path to Passwordless</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20231116test-coverage-beyond-unit-testing-li><a href=/blog/2023/11/16/test-coverage-beyond-unit-testing/ title="Test Coverage Beyond Unit Testing" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20231116test-coverage-beyond-unit-testing><span class=td-sidebar-nav-active-item>Coverage for E2E Tests</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231022how-to-write-modifiable-readable-go-code-li><a href=/blog/2023/10/22/how-to-write-modifiable-readable-go-code/ title="How To Write Modifiable & Readable Go Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231022how-to-write-modifiable-readable-go-code><span>Quality Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231008how-to-write-performant-go-code-li><a href=/blog/2023/10/08/how-to-write-performant-go-code/ title="How To Write Performant Go Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231008how-to-write-performant-go-code><span>Performant Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230823gophercon-uk-2023-li><a href=/blog/2023/08/23/gophercon-uk-2023/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230823gophercon-uk-2023><span>GopherCon UK 2023</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230622beautiful-state-machines-fsm-part-ii-li><a href=/blog/2023/06/22/beautiful-state-machines-fsm-part-ii/ title="Beautiful State-Machines - FSM Part II" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230622beautiful-state-machines-fsm-part-ii><span>Beautiful State-Machines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230613the-agency-workshop-li><a href=/blog/2023/06/13/the-agency-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230613the-agency-workshop><span>The Agency Workshop</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now-li><a href=/blog/2023/06/09/the-time-to-build-ssi-capabilities-is-now/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now><span>The Time to Build SSI Capabilities Is Now</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation-li><a href=/blog/2023/05/25/digital-identity-hack-part-3-introduction-to-ssi-presentation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation><span>Digital Identity Hack Part 3 – Introduction to SSI Presentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects-li><a href=/blog/2023/05/23/digital-identity-hack-part-2-panel-discussion-on-blockchain-projects/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects><span>Digital Identity Hack Part 2 – Panel Discussion on Blockchain Projects</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi-li><a href=/blog/2023/05/11/digital-identity-hack-unlocking-the-potential-of-ssi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi><span>Digital Identity Hack – Unlocking the Potential of SSI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230508deploying-with-cdk-pipeline-li><a href=/blog/2023/05/08/deploying-with-cdk-pipeline/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230508deploying-with-cdk-pipeline><span>Deploying with CDK Pipeline</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230425agencys-iac-journey-li><a href=/blog/2023/04/25/agencys-iac-journey/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230425agencys-iac-journey><span>Agency's IaC Journey</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i-li><a href=/blog/2023/03/13/no-code-ssi-chatbots-fsm-part-i/ title="No-Code SSI Chatbots - FSM Part I" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i><span>No-Code SSI Chatbots</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers-li><a href=/blog/2023/02/06/how-to-equip-your-app-with-vc-superpowers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers><span>How to Equip Your App with VC Superpowers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230130getting-started-with-ssi-service-agent-development-li><a href=/blog/2023/01/30/getting-started-with-ssi-service-agent-development/ title="Getting Started with SSI Service Agent Development " class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230130getting-started-with-ssi-service-agent-development><span>Getting Started with SSI Service Agent Development</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220930ledger-multiplexer-li><a href=/blog/2022/09/30/ledger-multiplexer/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220930ledger-multiplexer><span>Ledger Multiplexer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220927the-hyperledger-global-forum-experience-li><a href=/blog/2022/09/27/the-hyperledger-global-forum-experience/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220927the-hyperledger-global-forum-experience><span>The Hyperledger Global Forum Experience</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220829the-findy-agency-api-li><a href=/blog/2022/08/29/the-findy-agency-api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220829the-findy-agency-api><span>The Findy Agency API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220427trust-in-your-wallet-li><a href=/blog/2022/04/27/trust-in-your-wallet/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220427trust-in-your-wallet><span>Trust in Your Wallet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220407ssi-empowered-identity-provider-li><a href=/blog/2022/04/07/ssi-empowered-identity-provider/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220407ssi-empowered-identity-provider><span>SSI-Empowered Identity Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220314replacing-indy-sdk-li><a href=/blog/2022/03/14/replacing-indy-sdk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220314replacing-indy-sdk><span>Replacing Indy SDK</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220305the-missing-network-layer-model-li><a href=/blog/2022/03/05/the-missing-network-layer-model/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220305the-missing-network-layer-model><span>The Missing Network Layer Model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220119fostering-interoperability-li><a href=/blog/2022/01/19/fostering-interoperability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220119fostering-interoperability><span>Fostering Interoperability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211109anchoring-chains-of-trust-li><a href=/blog/2021/11/09/anchoring-chains-of-trust/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211109anchoring-chains-of-trust><span>Anchoring Chains of Trust</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210920the-arm-adventure-on-docker-li><a href=/blog/2021/09/20/the-arm-adventure-on-docker/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210920the-arm-adventure-on-docker><span>The Arm Adventure on Docker</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210908travelogue-li><a href=/blog/2021/09/08/travelogue/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210908travelogue><span>Travelogue</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210811announcing-findy-agency-li><a href=/blog/2021/08/11/announcing-findy-agency/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210811announcing-findy-agency><span>Announcing Findy Agency</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a id=print href=/blog/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#complementing-unit-tests>Complementing Unit Tests</a></li><li><a href=#keeping-the-knight-in-shape>Keeping the Knight in Shape</a></li><li><a href=#coverage-for-application-tests>Coverage for Application Tests</a></li><li><a href=#instrumenting-the-container-binary>Instrumenting the Container Binary</a></li><li><a href=#increased-coverage>Increased Coverage</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Test Coverage Beyond Unit Testing</h1><div class=lead>Automated testing is like having an extra member in your team, a shining knight against regression. Test coverage measurements and automatic test coverage monitoring help the team keep the knight shiny, i.e., automated test sets in good shape. Traditionally, we have measured the coverage for unit tests, but thorough CI pipelines also include other types of testing. Go has recently introduced new tooling that allows us to measure the test coverage for application tests and thus improve our capabilities for keeping our automated tests in shape automatically.</div><div class="td-byline mb-4">By <b>Laura Vuorenoja</b> |
<time datetime=2023-11-16 class=text-body-secondary>Thursday, November 16, 2023</time></div><header class=article-meta></header><p>Automated testing is your superpower against <a href=https://en.wikipedia.org/wiki/Software_regression>regression</a>.
It prevents you from breaking existing
functionality when introducing new code changes. The most important aspect of automated testing
is <strong>automation</strong>. The testing should happen automatically in the continuous integration (CI) pipeline
whenever developers do code changes. If the tests are not passing, the team shouldn&rsquo;t merge
the changes to the main branch. I often regard the automated test set as
an extra team member – the team&rsquo;s tireless knight against regression.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:935px><img class=card-img-top src=/blog/2023/11/16/test-coverage-beyond-unit-testing/cover-knight_hu43378c79be2c98339b1f64f1c1dc1193_958813_925x925_fit_catmullrom_3.png width=925 height=520><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Automated test set - the team's knight against regression</em></p></figcaption></figure><h2 id=complementing-unit-tests>Complementing Unit Tests</h2><p>The automated test set usually consists of many types of testing. Unit tests are
the bread and butter of any project&rsquo;s quality assurance process. But quite often,
we need something more to complement the unit tests.</p><p>We usually write simulation code for external functionality to keep the unit tests relevant,
modular, and fast to execute. However, wasting the team&rsquo;s resources on creating
the simulation code doesn&rsquo;t always make sense. Furthermore, we don&rsquo;t include simulation code
in the end product. Therefore, we should also have testing that verifies the functionality
with the proper external dependencies.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:935px><img class=card-img-top src=/blog/2023/11/16/test-coverage-beyond-unit-testing/application-tests_hu8e30c00aa0d117d2d4764565470d4365_109885_925x925_fit_catmullrom_3.png width=925 height=335><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Findy Agency application tests are run in GitHub Actions workflows,
utilizing docker-compose to orchestrate the agency services.</em></p></figcaption></figure><p>Application (integration/e2e) tests execute the software without unit testing tooling
in the software&rsquo;s &ldquo;real&rdquo; running environment and with as many actual external dependencies
as possible. Those tests validate the functionality from the end user&rsquo;s point of view.
They complement unit tests, especially when verifying interoperability, asynchronous
functionality, and other software features that are difficult or impossible to test with unit testing.</p><h2 id=keeping-the-knight-in-shape>Keeping the Knight in Shape</h2><p>Test coverage measurement is the process that can gather data on which code lines the test executes.
Typically, this tooling is available for unit tests. Although coverage measurement and
result data visualization can be handy in a local development cycle, I see the most value
when the team integrates the coverage measurement with the CI pipeline and automated monitoring
tooling that utilizes the coverage data.</p><p>The automated monitoring tool is an external service that stores the coverage data from
the test runs over time. When the team creates new pull requests, unit tests measure
the coverage data, and the pipeline sends the data to the monitor. It can then automatically
alert the team if the test coverage is about to decrease with the new changes.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:935px><img class=card-img-top src=/blog/2023/11/16/test-coverage-beyond-unit-testing/monitor_hub2348bafb99ceadc4fcbe1cf05b3249f_581568_925x925_fit_catmullrom_3.png width=925 height=461><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em><a href=https://about.codecov.io/ target=_blank>Codecov.io</a> is an example of
a SaaS-service that can be used as an automatic test coverage monitor.</em></p></figcaption></figure><p>Thus, the automated coverage monitoring keeps the team&rsquo;s knight in good shape. Developers
cannot add new code without adding new tests to the knight&rsquo;s toolbox. Or at least
the decision to decrease the coverage needs to be made knowingly. Forgetting to add
tests is easy, but it gets trickier when someone nags you about it (automatically).</p><p>However, as stated above, we are used to measuring the coverage only for unit test runs.
But as we also test without the unit test tooling, i.e., application tests, we would like
to gather and utilize the data similarly for those test runs.</p><h2 id=coverage-for-application-tests>Coverage for Application Tests</h2><p><a href=https://go.dev/blog/integration-test-coverage>Go 1.20 introduced a new feature flag</a>
for the <code>go build</code> command, <code>-cover</code>.
The new flag enables the developer to build an instrumented version of the software binary.
When running the instrumented version, it produces coverage data for the run,
as with the unit tests.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># build with –cover flag</span>
</span></span><span style=display:flex><span>go build –cover -o ./program
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># define folder for result files</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GOCOVERDIR</span><span style=color:#ce5c00;font-weight:700>=</span>”./coverage”
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># run binary (and the application tests)</span>
</span></span><span style=display:flex><span>./program
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># convert and analyze result files</span>
</span></span><span style=display:flex><span>go tool covdata textfmt –i<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$GOCOVERDIR</span> –o coverage.txt
</span></span></code></pre></div><p>Using the new feature means we can include the test coverage of the application test runs in the automated monitoring scope. We put this new feature to use in the Findy Agency project.</p><h2 id=instrumenting-the-container-binary>Instrumenting the Container Binary</h2><p>Measuring the test coverage for application tests meant we needed to refactor our application testing
pipeline so that CI could gather the data and send it to the analysis tool.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:935px><img class=card-img-top src=/blog/2023/11/16/test-coverage-beyond-unit-testing/steps_hu2268f6181c3050030bd2fc971e9b0029_119649_925x925_fit_catmullrom_3.png width=925 height=234><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Acceptance application test set for Findy Agency microservice are run using
<a href=https://github.com/findy-network/e2e-test-action target=_blank>a dedicated GitHub Action</a>.
The action is capable of building and running the container with instrumented binary and reporting the
coverage data back to the parent job.</em></p></figcaption></figure><ul><li>We use <a href=https://github.com/findy-network/e2e-test-action>a shared GitHub action</a> to execute
the same application acceptance test set for all
our microservices. The action handles setting up the agency environment and running the test set.</li><li>Service Docker images used in the application tests must have the instrumented binary.
We modified <a href=https://github.com/findy-network/findy-agent-vault/blob/master/Dockerfile>the Docker image</a>
build phase to include the new <code>-cover</code> flag.</li><li>We define the <code>GO_COVERDIR</code> environment variable in the service image,
and the environment definition maps that container path to a folder in the local environment.</li><li>Once the agency is running, GitHub Action executes the tests. After test execution,
<a href=https://github.com/findy-network/findy-agent-vault/blob/cda27be1aaacdf1e73f8c879408134ce1f2fa076/.github/workflows/test.yml#L30>CI copies the result files</a>,
converts and sends them to the analysis tool as with unit tests.</li></ul><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:635px><img class=card-img-top src=/blog/2023/11/16/test-coverage-beyond-unit-testing/dockerfile_hu216f917a74fdb96b6b60aede5ac7aa36_516947_625x625_fit_catmullrom_3.png width=625 height=460><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Changes required to service Dockerfile.</em></p></figcaption></figure><h2 id=increased-coverage>Increased Coverage</h2><p>The change has the expected effect: coverage increased in our repositories where we introduced
this change. The coverage counts now in previously unmonitored code blocks, such as code in the <code>main</code>
function that was missing unit tests. The change improves our understanding of our testing scope and
helps us to keep our automated test set in better shape.</p><p>You can inspect the approach, for example, in the <a href=https://github.com/findy-network/findy-agent-vault/tree/master#findy-agent-vault>findy-agent-vault</a>
repository CI configuration.</p><p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/EwCFRVkqHic?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><em>Watch my &ldquo;Boosting Test Coverage for Microservices&rdquo; talk on GopherCon UK on YouTube.</em></p><p><strong>Note!</strong> The coverage data is lost if the process is forced to be terminated and it doesn&rsquo;t handle
the termination signal gracefully. Ungraceful termination prevents the added instrumentation code
from writing the coverage file. Therefore, the service needs to
have graceful shutdown in place. Also, the Docker container runtime needs to pass
the <code>SIGTERM</code> signal to the server process for this approach to work.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2023/10/22/how-to-write-modifiable-readable-go-code/ aria-label="Previous - How To Write Modifiable & Readable Go Code" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/blog/2024/01/05/path-to-passwordless/ aria-label="Next - Path to Passwordless" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/findy-network aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>The Findy Agency Authors</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><p class="td-footer__about mt-2"><a href=/about/>About Findy Agency</a></p></div></div></div></footer></div><script src=/js/deflate.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity="sha512-r2+FkHzf1u0+SQbZOoIz2RxWOIWfdEzRuYybGjzKq18jG9zaSfEy9s3+jMqG/zPtRor/q4qaUCYQpmSjTw8M+g==" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity="sha512-INps9zQ2GUEMCQD7xiZQbGUVnqnzEvlynVy6eqcTcHN4+aQiLo9/uaQqckDpdJ8Zm3M0QBs+Pktg4pz0kEklUg==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity="sha512-YJVxTjqttjsU3cSvaTRqsSl0wbRgZUNF+NGGCgto/MUbIvaLdXQzGTCQu4CvyJZbZctgflVB0PXw9LLmTWm5/w==" crossorigin=anonymous onload=renderMathInElement(document.body,null)></script><script src=/js/main.min.707e26db94486c03ddc6847e7aea1444dc611101bd171e20143f53029c146108.js integrity="sha256-cH4m25RIbAPdxoR+euoURNxhEQG9Fx4gFD9TApwUYQg=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>