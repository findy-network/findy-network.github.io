<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.91.2"><meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Agency's IaC Journey | Findy Agency</title>
<meta name=description content="Findy Agency documentation"><meta property="og:title" content="Agency's IaC Journey">
<meta property="og:description" content="Findy Agency's demo environment in the cloud has a fully automated deployment pipeline. The colorful history of the project's IaC tooling includes different phases, from writing CloudFormation YAML manually to porting the deployment on top of CDK pipelines.">
<meta property="og:type" content="article">
<meta property="og:url" content="/blog/2023/04/25/agencys-iac-journey/"><meta property="og:image" content="/blog/2023/04/25/agencys-iac-journey/cover-iac-journey.png"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2023-04-25T00:00:00+00:00">
<meta property="article:modified_time" content="2023-04-25T00:00:00+00:00"><meta property="og:site_name" content="Findy Agency">
<meta itemprop=name content="Agency's IaC Journey">
<meta itemprop=description content="Findy Agency's demo environment in the cloud has a fully automated deployment pipeline. The colorful history of the project's IaC tooling includes different phases, from writing CloudFormation YAML manually to porting the deployment on top of CDK pipelines."><meta itemprop=datePublished content="2023-04-25T00:00:00+00:00">
<meta itemprop=dateModified content="2023-04-25T00:00:00+00:00">
<meta itemprop=wordCount content="864"><meta itemprop=image content="/blog/2023/04/25/agencys-iac-journey/cover-iac-journey.png">
<meta itemprop=keywords content><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/blog/2023/04/25/agencys-iac-journey/cover-iac-journey.png">
<meta name=twitter:title content="Agency's IaC Journey">
<meta name=twitter:description content="Findy Agency's demo environment in the cloud has a fully automated deployment pipeline. The colorful history of the project's IaC tooling includes different phases, from writing CloudFormation YAML manually to porting the deployment on top of CDK pipelines.">
<link rel=preload href=/scss/main.min.957d988e396d495afa3156d4640b99742d961f39c79e92f8d152969969aa9ece.css as=style>
<link href=/scss/main.min.957d988e396d495afa3156d4640b99742d961f39c79e92f8d152969969aa9ece.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class="td-page td-blog">
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Findy Agency</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docs/><span>Documentation</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/blog/><span class=active>Blog</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block">
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<form class="td-sidebar__search d-flex align-items-center">
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li>
<a href=/blog/ title="Findy Agency Blog" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20230425agencys-iac-journey-li>
<a href=/blog/2023/04/25/agencys-iac-journey/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20230425agencys-iac-journey><span class=td-sidebar-nav-active-item>Agency's IaC Journey</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230313no-code-ssi-chatbots-part-i-li>
<a href=/blog/2023/03/13/no-code-ssi-chatbots-part-i/ title="No-Code SSI Chatbots - Part I" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230313no-code-ssi-chatbots-part-i><span>No-Code SSI Chatbots</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers-li>
<a href=/blog/2023/02/06/how-to-equip-your-app-with-vc-superpowers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers><span>How to Equip Your App with VC Superpowers</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230130getting-started-with-ssi-service-agent-development-li>
<a href=/blog/2023/01/30/getting-started-with-ssi-service-agent-development/ title="Getting Started with SSI Service Agent Development " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230130getting-started-with-ssi-service-agent-development><span>Getting Started with SSI Service Agent Development</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220930ledger-multiplexer-li>
<a href=/blog/2022/09/30/ledger-multiplexer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220930ledger-multiplexer><span>Ledger Multiplexer</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220927the-hyperledger-global-forum-experience-li>
<a href=/blog/2022/09/27/the-hyperledger-global-forum-experience/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220927the-hyperledger-global-forum-experience><span>The Hyperledger Global Forum Experience</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220829the-findy-agency-api-li>
<a href=/blog/2022/08/29/the-findy-agency-api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220829the-findy-agency-api><span>The Findy Agency API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220427trust-in-your-wallet-li>
<a href=/blog/2022/04/27/trust-in-your-wallet/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220427trust-in-your-wallet><span>Trust in Your Wallet</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220407ssi-empowered-identity-provider-li>
<a href=/blog/2022/04/07/ssi-empowered-identity-provider/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220407ssi-empowered-identity-provider><span>SSI-Empowered Identity Provider</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220314replacing-indy-sdk-li>
<a href=/blog/2022/03/14/replacing-indy-sdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220314replacing-indy-sdk><span>Replacing Indy SDK</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220305the-missing-network-layer-model-li>
<a href=/blog/2022/03/05/the-missing-network-layer-model/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220305the-missing-network-layer-model><span>The Missing Network Layer Model</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220119fostering-interoperability-li>
<a href=/blog/2022/01/19/fostering-interoperability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220119fostering-interoperability><span>Fostering Interoperability</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211109anchoring-chains-of-trust-li>
<a href=/blog/2021/11/09/anchoring-chains-of-trust/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211109anchoring-chains-of-trust><span>Anchoring Chains of Trust</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210920the-arm-adventure-on-docker-li>
<a href=/blog/2021/09/20/the-arm-adventure-on-docker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210920the-arm-adventure-on-docker><span>The Arm Adventure on Docker</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210908travelogue-li>
<a href=/blog/2021/09/08/travelogue/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210908travelogue><span>Travelogue</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210811announcing-findy-agency-li>
<a href=/blog/2021/08/11/announcing-findy-agency/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210811announcing-findy-agency><span>Announcing Findy Agency</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a id=print href=/blog/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a>
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#setup-infra-without-a-hassle>Setup Infra without a Hassle</a></li>
<li><a href=#from-manual-yaml-to-cdk>From Manual YAML to CDK</a></li>
<li><a href=#the-missing-puzzle-piece>The Missing Puzzle Piece</a></li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main>
<a class="btn btn-lg -bg-orange td-rss-button d-none d-lg-block" href=/blog/index.xml target=_blank>
RSS <i class="fa fa-rss ml-2"></i>
</a>
<div class=td-content>
<h1>Agency's IaC Journey</h1>
<div class=lead>Findy Agency&rsquo;s demo environment in the cloud has a fully automated deployment pipeline. The colorful history of the project&rsquo;s IaC tooling includes different phases, from writing CloudFormation YAML manually to porting the deployment on top of CDK pipelines.</div>
<div class="td-byline mb-4">
By <b>Laura Vuorenoja</b> |
<time datetime=2023-04-25 class=text-muted>Tuesday, April 25, 2023</time>
</div>
<header class=article-meta>
</header>
<p>In the early days of Findy Agency&rsquo;s development project, it became evident that we needed
a continuously running environment in the cloud to try out different proofs-of-concept (PoCs)
and demos quickly and easily. As our team is small, we wanted to rely heavily on automation
and avoid wasting time on manual deployments.</p>
<h2 id=setup-infra-without-a-hassle>Setup Infra without a Hassle</h2>
<p>At that time, I was interested in improving my AWS skills, so I took the challenge and
started working on a continuous PoC environment for our project. As an innovation unit,
we experiment constantly and want to try different things quickly,
so the PoC environment also needed to accommodate this agility.</p>
<p>
<figure>
<img src=https://github.com/findy-network/findy-agent-infra/raw/master/aws-ecs/docs/arch.png width=925>
</figure>
<em>Overview of the AWS deployment for the demo environment</em></p>
<p>From the start, it was clear that I wanted to use IaC (infrastructure as code) tools to define
our infra. My target was to create scripts that anyone could easily take and
set up the agency without a hassle.</p>
<p>I had been using <a href=https://www.terraform.io/>Terraform</a> in some of my earlier projects, but using
a third-party tool typically requires compromises, so I wanted to take the native option for
a change with the IaC-tooling as well. The initial target was not to find the ultimate DevOps tools
but more in the experimentation spirit to find tooling and methods suitable for our flexible needs.</p>
<h2 id=from-manual-yaml-to-cdk>From Manual YAML to CDK</h2>
<p>Back then, the only AWS-native choice for IaC-tooling was to manually start writing
the CloudFormation templates. <a href=https://aws.amazon.com/cloudformation/>CloudFormation</a> is
an AWS service that one can use to provision the infrastructure with
JSON- or YAML-formatted templates. CloudFormation stack is an entity that holds
the infrastructure resources. All the resources defined in the stack template are created and
removed together with the stack. One can manage the infrastructure stacks through the AWS CLI or
the CloudFormation UI.</p>
<p>So the first iteration of the agency&rsquo;s AWS infra code was about writing a lot of YAML definitions,
deploying them from the local laptop using the AWS CLI, fixing errors, and retrying.
The process could have been more efficient and successful in many ways. For example,
there was just not enough time to figure out everything needed and, in many cases,
the desired level of automation required to write countless custom scripts.</p>
<div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:535px>
<img class=card-img-top src=/blog/2023/04/25/agencys-iac-journey/yaml-example_hu60a7a54e5b215f57e1c6ace31bf7ab89_175789_525x525_fit_catmullrom_3.png width=525 height=447>
<div class="card-body px-0 pt-2 pb-0">
<p class=card-text>
<em>Example of a YAML template</em>
</p>
</div>
</div>
<p>After some time of struggling with the YAML, AWS released the <a href=https://aws.amazon.com/cdk/>CDK</a>
(Cloud Development Kit). The purpose of the CDK is to allow developers to write
the CloudFormation templates using familiar programming languages. CDK tooling converts
the code written by the developer to CloudFormation templates.</p>
<p>Writing declarative definitions using imperative programming languages felt a bit off for me at first,
but I decided to try it. There were some evident benefits:</p>
<ul>
<li>CDK offers constructs that combine CloudFormation resources with higher-level abstractions.
There is less need to know the dirty details of each resource.</li>
<li>Sharing, customizing, and reusing constructs is more straightforward.</li>
<li>One can use her favorite IDE to write the infra code. Therefore tools like code completion are available.</li>
<li>Also, there are other language-specific tools. One can apply dependency management, versioning,
and even unit testing to the infra code similarly to other software projects.</li>
</ul>
<div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:685px>
<img class=card-img-top src=/blog/2023/04/25/agencys-iac-journey/cdk-example_hu44f0290caad9bdcd00128acf3a502abc_227494_675x575_fit_catmullrom_3.png width=675 height=333>
<div class="card-body px-0 pt-2 pb-0">
<p class=card-text>
<em>Example of CDK code</em>
</p>
</div>
</div>
<h2 id=the-missing-puzzle-piece>The Missing Puzzle Piece</h2>
<p>Switching to CDK tooling boosted my performance for the infra work significantly.
Also, the manual hassle with the YAML templates is something I have not longed for at all.
Still, it felt like something was missing. I was still running the infra setup scripts
from my laptop. In my ideal world, the pipeline would create the infra, keeping things
more reproducible and less error-prone. Also, defining the build pipeline and the deployment
needed custom steps that made the initial agency setup still complex, which was something that
I wanted to avoid in the first place.</p>
<p>Well, time went on, and we were happy with the deployment pipeline: regardless of
the setup process, it worked as expected. However, in the spring of 2022, I saw
an <a href="https://op-careers.fi/content/What-is-studying-at-the-Software-Academy-all-about/?locale=en_GB">OP Software Academy</a>
course about the CDK. The Academy is our internal training organization
that offers courses around several topics. I decided to join the class and learn more about CDK
and get some validation if I had done things correctly.</p>
<div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:635px>
<img class=card-img-top src=/blog/2023/04/25/agencys-iac-journey/pipeline-example_hue440677f79cc822bad704687c5eb5835_157342_625x625_fit_catmullrom_3.png width=625 height=342>
<div class="card-body px-0 pt-2 pb-0">
<p class=card-text>
<em>Pipeline creation with CDK code</em>
</p>
</div>
</div>
<p>In the course, I found the missing piece of my puzzle. As it happened, AWS had just released <a href=https://docs.aws.amazon.com/cdk/v2/guide/migrating-v2.html>CDK v2</a>,
which introduced a new concept, <a href=https://docs.aws.amazon.com/cdk/v2/guide/cdk_pipeline.html>CDK pipelines</a>.
CDK pipeline is yet another higher-level abstraction, this time for <em>AWS continuous integration
and deployment tools</em>. It utilizes AWS CodePipeline to build, test and deploy the application.
The CDK pipeline&rsquo;s beauty lies in its setup: it is deployed only once from the developer&rsquo;s desktop.
After the creation, the pipeline handles the infra-deployment and subsequent changes to
the deployment or the pipeline via version control.</p>
<div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:935px>
<img class=card-img-top src=/blog/2023/04/25/agencys-iac-journey/cover-iac-journey_hu8ea8cb855c58375c168ced9efb5edf51_74721_925x925_fit_catmullrom_3.png width=925 height=178>
<div class="card-body px-0 pt-2 pb-0">
<p class=card-text>
<em>Evolution of Agency IaC tooling</em>
</p>
</div>
</div>
<p>After porting our deployment on top of the CDK pipeline, the setup has finally reached my standards.
However, the future will show us how the Agency deployment will evolve. Perhaps we will introduce
a more platform-agnostic approach and remove AWS native tooling altogether.</p>
<p>You can do a deep dive into the anatomy of our CDK pipeline in my next blog post.
And as always, you can find the codes on <a href=https://github.com/findy-network/findy-agent-infra/tree/master/aws-ecs#readme>GitHub</a>!</p>
<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
<li>
<a href=/blog/2023/03/13/no-code-ssi-chatbots-part-i/ aria-label="Previous - No-Code SSI Chatbots - Part I" class="btn btn-primary"><span class=mr-1>←</span> Previous</a>
</li>
<a class="btn btn-primary disabled">Next <span class=ml-1>→</span></a>
</li>
</ul>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/findy-network aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2023 The Findy Agency Authors All Rights Reserved</small>
<p class=mt-2><a href=/about/>About Findy Agency</a></p>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity=sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK crossorigin=anonymous></script>
<script src=/js/deflate.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css integrity=sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5 crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js integrity=sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body,null)></script>
<script src=/js/main.min.758c0b1476eb0de973b63d0030f104f41a6eb3afb9908681605af4a48eb73018.js integrity="sha256-dYwLFHbrDelztj0AMPEE9Bpus6+5kIaBYFr0pI63MBg=" crossorigin=anonymous></script>
</body>
</html>