<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.111.3"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Managing GitHub Branch Protections | Findy Agency</title><meta name=description content="GitHub is an excellent tool for modern software development. This article overviews how to combine efficient release automation with policies that protect the code from accidental changes and regression. We will learn how to configure the repository settings for branch protection and set up the GitHub Actions release workflow."><meta property="og:title" content="Managing GitHub Branch Protections"><meta property="og:description" content="GitHub is an excellent tool for modern software development. This article overviews how to combine efficient release automation with policies that protect the code from accidental changes and regression. We will learn how to configure the repository settings for branch protection and set up the GitHub Actions release workflow."><meta property="og:type" content="article"><meta property="og:url" content="https://findy-network.github.io/blog/2024/03/27/managing-github-branch-protections/"><meta property="og:image" content="https://findy-network.github.io/blog/2024/03/27/managing-github-branch-protections/cover-main-all.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-03-27T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-27T00:00:00+00:00"><meta property="og:site_name" content="Findy Agency"><meta itemprop=name content="Managing GitHub Branch Protections"><meta itemprop=description content="GitHub is an excellent tool for modern software development. This article overviews how to combine efficient release automation with policies that protect the code from accidental changes and regression. We will learn how to configure the repository settings for branch protection and set up the GitHub Actions release workflow."><meta itemprop=datePublished content="2024-03-27T00:00:00+00:00"><meta itemprop=dateModified content="2024-03-27T00:00:00+00:00"><meta itemprop=wordCount content="1598"><meta itemprop=image content="https://findy-network.github.io/blog/2024/03/27/managing-github-branch-protections/cover-main-all.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://findy-network.github.io/blog/2024/03/27/managing-github-branch-protections/cover-main-all.png"><meta name=twitter:title content="Managing GitHub Branch Protections"><meta name=twitter:description content="GitHub is an excellent tool for modern software development. This article overviews how to combine efficient release automation with policies that protect the code from accidental changes and regression. We will learn how to configure the repository settings for branch protection and set up the GitHub Actions release workflow."><link rel=preload href=/scss/main.min.fe387f54b6718948c0bf2601ff90a4fd03ef4cc0f5b2a71235d60ec478692d2d.css as=style><link href=/scss/main.min.fe387f54b6718948c0bf2601ff90a4fd03ef4cc0f5b2a71235d60ec478692d2d.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Findy Agency</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="Findy Agency Blog" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions-li><a href=/blog/2024/04/22/the-swiss-army-knife-for-the-agency-project-part-1-github-actions/ title="The Swiss Army Knife for the Agency Project, Part 1: GitHub Actions" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions><span>GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240411issuing-chatbot-li><a href=/blog/2024/04/11/issuing-chatbot/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240411issuing-chatbot><span>Issuing Chatbot</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240406i-want-mdl-li><a href=/blog/2024/04/06/i-want-mdl/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240406i-want-mdl><span>I want mDL!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20240327managing-github-branch-protections-li><a href=/blog/2024/03/27/managing-github-branch-protections/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20240327managing-github-branch-protections><span class=td-sidebar-nav-active-item>Managing GitHub Branch Protections</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240105path-to-passwordless-li><a href=/blog/2024/01/05/path-to-passwordless/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240105path-to-passwordless><span>Path to Passwordless</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231116test-coverage-beyond-unit-testing-li><a href=/blog/2023/11/16/test-coverage-beyond-unit-testing/ title="Test Coverage Beyond Unit Testing" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231116test-coverage-beyond-unit-testing><span>Coverage for E2E Tests</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231022how-to-write-modifiable-readable-go-code-li><a href=/blog/2023/10/22/how-to-write-modifiable-readable-go-code/ title="How To Write Modifiable & Readable Go Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231022how-to-write-modifiable-readable-go-code><span>Quality Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231008how-to-write-performant-go-code-li><a href=/blog/2023/10/08/how-to-write-performant-go-code/ title="How To Write Performant Go Code" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231008how-to-write-performant-go-code><span>Performant Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230823gophercon-uk-2023-li><a href=/blog/2023/08/23/gophercon-uk-2023/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230823gophercon-uk-2023><span>GopherCon UK 2023</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230622beautiful-state-machines-fsm-part-ii-li><a href=/blog/2023/06/22/beautiful-state-machines-fsm-part-ii/ title="Beautiful State-Machines - FSM Part II" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230622beautiful-state-machines-fsm-part-ii><span>Beautiful State-Machines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230613the-agency-workshop-li><a href=/blog/2023/06/13/the-agency-workshop/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230613the-agency-workshop><span>The Agency Workshop</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now-li><a href=/blog/2023/06/09/the-time-to-build-ssi-capabilities-is-now/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now><span>The Time to Build SSI Capabilities Is Now</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation-li><a href=/blog/2023/05/25/digital-identity-hack-part-3-introduction-to-ssi-presentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation><span>Digital Identity Hack Part 3 – Introduction to SSI Presentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects-li><a href=/blog/2023/05/23/digital-identity-hack-part-2-panel-discussion-on-blockchain-projects/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects><span>Digital Identity Hack Part 2 – Panel Discussion on Blockchain Projects</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi-li><a href=/blog/2023/05/11/digital-identity-hack-unlocking-the-potential-of-ssi/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi><span>Digital Identity Hack – Unlocking the Potential of SSI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230508deploying-with-cdk-pipeline-li><a href=/blog/2023/05/08/deploying-with-cdk-pipeline/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230508deploying-with-cdk-pipeline><span>Deploying with CDK Pipeline</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230425agencys-iac-journey-li><a href=/blog/2023/04/25/agencys-iac-journey/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230425agencys-iac-journey><span>Agency's IaC Journey</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i-li><a href=/blog/2023/03/13/no-code-ssi-chatbots-fsm-part-i/ title="No-Code SSI Chatbots - FSM Part I" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i><span>No-Code SSI Chatbots</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers-li><a href=/blog/2023/02/06/how-to-equip-your-app-with-vc-superpowers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers><span>How to Equip Your App with VC Superpowers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230130getting-started-with-ssi-service-agent-development-li><a href=/blog/2023/01/30/getting-started-with-ssi-service-agent-development/ title="Getting Started with SSI Service Agent Development " class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230130getting-started-with-ssi-service-agent-development><span>Getting Started with SSI Service Agent Development</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220930ledger-multiplexer-li><a href=/blog/2022/09/30/ledger-multiplexer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220930ledger-multiplexer><span>Ledger Multiplexer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220927the-hyperledger-global-forum-experience-li><a href=/blog/2022/09/27/the-hyperledger-global-forum-experience/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220927the-hyperledger-global-forum-experience><span>The Hyperledger Global Forum Experience</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220829the-findy-agency-api-li><a href=/blog/2022/08/29/the-findy-agency-api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220829the-findy-agency-api><span>The Findy Agency API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220427trust-in-your-wallet-li><a href=/blog/2022/04/27/trust-in-your-wallet/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220427trust-in-your-wallet><span>Trust in Your Wallet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220407ssi-empowered-identity-provider-li><a href=/blog/2022/04/07/ssi-empowered-identity-provider/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220407ssi-empowered-identity-provider><span>SSI-Empowered Identity Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220314replacing-indy-sdk-li><a href=/blog/2022/03/14/replacing-indy-sdk/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220314replacing-indy-sdk><span>Replacing Indy SDK</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220305the-missing-network-layer-model-li><a href=/blog/2022/03/05/the-missing-network-layer-model/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220305the-missing-network-layer-model><span>The Missing Network Layer Model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220119fostering-interoperability-li><a href=/blog/2022/01/19/fostering-interoperability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220119fostering-interoperability><span>Fostering Interoperability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211109anchoring-chains-of-trust-li><a href=/blog/2021/11/09/anchoring-chains-of-trust/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211109anchoring-chains-of-trust><span>Anchoring Chains of Trust</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210920the-arm-adventure-on-docker-li><a href=/blog/2021/09/20/the-arm-adventure-on-docker/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210920the-arm-adventure-on-docker><span>The Arm Adventure on Docker</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210908travelogue-li><a href=/blog/2021/09/08/travelogue/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210908travelogue><span>Travelogue</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210811announcing-findy-agency-li><a href=/blog/2021/08/11/announcing-findy-agency/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210811announcing-findy-agency><span>Announcing Findy Agency</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a id=print href=https://findy-network.github.io/blog/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#branch-protection-prevents-releasing>Branch Protection Prevents Releasing</a></li><li><a href=#rulesets-to-the-rescue>Rulesets to the Rescue</a></li><li><a href=#github-application>GitHub Application</a><ul><li><a href=#why-to-use-an-application>Why to Use an Application?</a></li><li><a href=#1-register-application>1. Register Application</a></li><li><a href=#2-download-private-key>2. Download Private Key</a></li><li><a href=#3-install-the-application>3. Install the Application</a></li></ul></li><li><a href=#remove-existing-branch-protections>Remove Existing Branch Protections</a></li><li><a href=#rulesets>Rulesets</a><ul><li><a href=#configuration>Configuration</a></li></ul></li><li><a href=#use-bot-in-github-actions-workflow>Use Bot in GitHub Actions Workflow</a><ul><li><a href=#add-secrets-for-release-workflow>Add Secrets for Release Workflow</a></li><li><a href=#generate-token-with-the-github-application>Generate Token with the GitHub Application</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class=td-rss-button title=RSS href=https://findy-network.github.io/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Managing GitHub Branch Protections</h1><div class=lead>GitHub is an excellent tool for modern software development. This article overviews how to combine efficient release automation with policies that protect the code from accidental changes and regression. We will learn how to configure the repository settings for branch protection and set up the GitHub Actions release workflow.</div><div class="td-byline mb-4">By <b>Laura Vuorenoja</b> |
<time datetime=2024-03-27 class=text-muted>Wednesday, March 27, 2024</time></div><header class=article-meta></header><p>GitHub has recently improved its automatic pull request handling and branch protection features.
I have found these features handy, and nowadays, I enable them regardless of the project type to
help me automate the project workflows and protect the code from accidental changes and regression bugs.</p><p>The features I find most useful are</p><ul><li><strong>Require a pull request before merging</strong>:
This setting enforces a model where the developers cannot accidentally
push changes to the project&rsquo;s main branches.</li><li><strong><a href=https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/about-protected-branches#require-status-checks-before-merging>Require status checks to pass before merging</a></strong>:
This branch protection setting allows one to configure which status checks
(e.g., unit tests, linting, etc.) must pass before merging the pull request.</li><li><strong><a href=https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/incorporating-changes-from-a-pull-request/automatically-merging-a-pull-request>Allow auto-merge</a></strong>:
This setting allows me to automate the merging of the PR once all
the CI has run all the needed checks. I do not need to wait for
the CI to complete the jobs. Instead, I can continue working on other things.
In addition, I use this feature to merge, for example, dependency updates automatically.
<em>Note: auto-merging works naturally only when the branch protection checks are in place.</em></li></ul><p>Until now, I have used GitHub&rsquo;s branch protection feature to enable these additional shields.
With this settings page, you can easily protect one or multiple branches
by configuring the abovementioned options.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/branch-protection_hu4ee9ed352abdacd015670eb3310f7e0a_133417_825x825_fit_catmullrom_3.png width=825 height=448><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>One can configure branch protection rules in the repository settings.</em></p></figcaption></figure><h2 id=branch-protection-prevents-releasing>Branch Protection Prevents Releasing</h2><p>However, when enforcing the branch protection, it applies to all users.
That also includes the bot user I am using in many projects to release:
<strong>creating a release tag</strong>, <strong>updating version numbers</strong>, and <strong>committing these changes
to the main branch</strong>.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:733px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/push-failed_hubc8d76ee3b027a7d7cf699ab818bd856_57968_825x825_fit_catmullrom_3.png width=723 height=203><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Releaser bot is unable to push version update when branch protection is enabled.</em></p></figcaption></figure><p>Suddenly, when the branch protection is enabled,
the release bot cannot do its duties as it cannot push to the protected branch.
Error states: <code>Protected branch update failed for refs/heads/&lt;branch_name>, X of X required status checks are expected.</code></p><p>Therefore, to overcome this problem, I have configured the bot to use pull requests.
These workaround pull requests have slowed the process and made it unreliable.
In some cases, I have been using a user token with administrative permissions to make the releases,
which I want to avoid as it has evident problems in the security model.</p><h2 id=rulesets-to-the-rescue>Rulesets to the Rescue</h2><p>Finally, this week, I reserved some time to investigate
whether it is possible to avoid these limitations.
I had two targets: first, I wanted to protect the main branch from accidental pushes
so developers could make changes only via pull requests vetted by the CI checks.
Second, I wanted the release bot to be able to bypass these rules and
push the tags and version changes to the main branch without issues.</p><p>I googled for an answer for a fair amount of time. It soon became apparent
that many others were struggling with the same problem, but also that GitHub
had released <a href=https://github.blog/2023-07-24-github-repository-rules-are-now-generally-available/>a new feature called rulesets</a>,
intended to solve the problem.
However, a few examples were available, and the configuration of the rulesets was not intuitive.
Therefore, I have documented the steps below if you wish to use a similar approach in your project.</p><p>The instructions below are three-phased:</p><ol><li><a href=#github-application>Creating a GitHub application for the release process operations</a></li><li><a href=#rulesets>Configuring rulesets that protect the main branch but still allow releasing</a></li><li><a href=#use-bot-in-github-actions-workflow>Using the newly created GitHub application in the GitHub Actions workflow</a></li></ol><h2 id=github-application>GitHub Application</h2><p>The first step is to <a href=https://docs.github.com/en/apps/creating-github-apps/about-creating-github-apps/about-creating-github-apps>create a GitHub application</a>
that handles the git operations in the CI release process for you.</p><h3 id=why-to-use-an-application>Why to Use an Application?</h3><p>There are multiple reasons why I chose to make a dedicated GitHub application instead of
using a personal access token or built-in GitHub Actions token directly:</p><ul><li><strong>The App</strong> installed in an organization <strong>is not attached to the user&rsquo;s role</strong>
or resource access as opposed to the personal access tokens.</li><li><strong>App does not reserve a seat from the organization.</strong>
Creating an actual new GitHub user would reserve a seat.</li><li>One can <strong>grant an application special permissions</strong> in rulesets.
We want to treat all other (human) users similarly
and only grant the bot user special access.
This approach is impossible when using personal access tokens or built-in tokens.</li><li>We want to <strong>activate other actions from pushes done by the releaser</strong>. For instance,
if we create a tag with the releaser bot, we want the new tag to trigger
several other actions, e.g., the building and packaging the project binary.
If using a built-in GitHub Actions token, new workflows would not be triggered,
as workflows are not allowed to trigger other workflows.</li></ul><p>One can use GitHub Applications for multiple and more powerful purposes,
but the releaser bot only needs minimal configuration as its only duty
is to do the releasing-related chores.</p><h3 id=1-register-application>1. Register Application</h3><p>Start the application registration via user profile <code>Developer settings</code> or
<a href=https://github.com/settings/apps/new>this link</a>.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/register-new-app_huffbcabf72d8652cc02d59e237746c8be_117578_825x825_fit_catmullrom_3.png width=825 height=523><figcaption class="card-body px-0 pt-2 pb-0"><p class=card-text><em>Registering new GitHub application.</em></p></figcaption></figure><p>When creating the new application for the releasing functionality,
the following settings need to be defined:</p><ul><li>Application name: e.g. <code>releaser-bot</code></li><li>Homepage URL: e.g. the repository URL</li><li>Untick <code>Webhook/Active</code>, as we don&rsquo;t need webhook notifications.</li><li>Choose permissions: <code>Permissions</code>/<code>Repository</code>/<code>Contents</code>/<code>Read and write</code>.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/permissions_hu77ba11ce983ab70b41bbe7ffe1a10647_113580_825x825_fit_catmullrom_3.png width=825 height=328></figure></li><li>Choose selection: <code>Where can this GitHub App be installed?</code>
<strong>Note: If you want to use the application in an organization&rsquo;s repositories, make it public.</strong></li><li>Push <code>Create GitHub App</code>.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/create_huff43daf64bf32883e59e045b7aacfcb6_76576_825x825_fit_catmullrom_3.png width=825 height=247></figure></li></ul><h3 id=2-download-private-key>2. Download Private Key</h3><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/priv-key_huef06acee7986fb8a66f3c44e525e33af_191805_825x825_fit_catmullrom_3.png width=825 height=393></figure><p>After creating the app, you will receive a note saying,
<code>Registration successful. You must generate a private key to install your GitHub App.</code>
Navigate to the private keys section and push the <code>Generate a private key</code> button.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/priv-key2_hu3d97fb7e994d07a5cd9e3459a6406529_68519_825x825_fit_catmullrom_3.png width=825 height=298></figure></p><p><strong>The private key file will download to your computer.
Store it in a secure place; you will need it later.</strong></p><h3 id=3-install-the-application>3. Install the Application</h3><p>Before using the application in your repository&rsquo;s workflow:</p><ol><li>Install the app in the target repository.
In the created application settings, go to the <code>Install App</code> section.</li><li>Select the user or organization for which you want to install the application.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/install-app_hu603f25e73f664cca4ca63b42af6e1f68_109153_825x825_fit_catmullrom_3.png width=825 height=207></figure></li><li>Select if you wish to use the application in a single repository or all account repositories.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:623px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/install-app2_hu6854b59c4da76ffdfc979909578a987f_204287_825x825_fit_catmullrom_3.png width=613 height=825></figure></li><li>Push the <code>Install</code> button.</li></ol><h2 id=remove-existing-branch-protections>Remove Existing Branch Protections</h2><p>The rulesets feature will work on behalf of
the branch protection settings. To avoid having overlapping configurations,
remove first any existing branch protections.</p><h2 id=rulesets>Rulesets</h2><p>The next step is to create the rulesets.</p><p>I crafted the following approach according to the original idea presented in <a href=https://github.blog/2023-07-24-github-repository-rules-are-now-generally-available/#bypass-with-ease-or-how-i-learned-to-stop-worrying-and-love-the-bot>the GitHub blog</a>.
The goal is to protect the main branch so that:</p><ol><li>Developers can make changes only via pull requests that have passed the status check <code>test</code>.</li><li>The releaser bot can push tags and update versions in the GitHub Actions workflow directly
to the main branch without creating pull requests.</li></ol><p>You may modify the settings according to your needs. For instance, you may require additional
status checks or require a review of the PR before one can merge it into the main branch.</p><h3 id=configuration>Configuration</h3><p>First, we will create a rule for all users. We do not allow anyone to delete refs or force push changes.
Go to the repository settings and select <code>Rulesets</code>:</p><ol><li>Create a <code>New ruleset</code> by tapping the <code>New branch ruleset</code>.</li><li>Give the <code>Main: all</code> name for the ruleset.</li><li>Set <code>Enforcement status</code> as <code>Active</code>.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/cover-main-all_hu8bd54ffc9485ddee115330e340165732_80217_825x825_fit_catmullrom_3.png width=825 height=329></figure></li><li>Leave <code>Bypass list</code> empty.</li><li>Add a new target branch. <code>Include default branch</code> (assuming the repository default branch is main).<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/targets_hu8e5a175ba9364e4ea9af6fc25a8aee43_50145_825x825_fit_catmullrom_3.png width=825 height=318></figure></li><li>In <code>Rules</code> section, tick <code>Restrict deletions</code> and <code>Block force pushes</code>.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:789px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/rules1_hu136f58b7d93df6c09e576d0aa26ab63d_120333_825x825_fit_catmullrom_3.png width=779 height=825></figure></li><li>Push the <code>Create</code> button.</li></ol><p>Then, we will create another ruleset that requires PRs
and status checks for any user other than the releaser bot.</p><ol><li>Create a <code>New ruleset</code> by tapping the <code>New branch ruleset</code>.</li><li>Give the <code>Main: require PR except for releaser</code> name for the ruleset.</li><li>Set <code>Enforcement</code> status as <code>Active</code>.</li><li>Add your releaser application to the <code>Bypass list</code>.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:814px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/main-require-pr_hu2059934167386587d85a509d865f6732_52519_825x825_fit_catmullrom_3.png width=804 height=393></figure></li><li>Add a new target branch. <code>Include default branch</code> (assuming the repository default branch is main).</li><li>Tick <code>Require a pull request before merging.</code><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/pr-require_hu9286d329c3fd4e7370f228821670074c_82906_825x825_fit_catmullrom_3.png width=825 height=407></figure></li><li>Tick <code>Require status checks to pass</code> and <code>Require branches to be up to date before merging.</code>
Add <code>test</code> as a required status check.<figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:806px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/require-status-checks_hud944c53c872688cbdaa203c32ee20583_54522_825x825_fit_catmullrom_3.png width=796 height=337></figure></li><li>Push the <code>Create</code> button.</li></ol><h2 id=use-bot-in-github-actions-workflow>Use Bot in GitHub Actions Workflow</h2><p>The final step is configuring the release process to use our newly created GitHub application.</p><h3 id=add-secrets-for-release-workflow>Add Secrets for Release Workflow</h3><p>To create a token for the releaser bot in the GitHub Actions workflow,
we must have two secret variables available.</p><p>Go to repository <code>Settings</code> / <code>Secrets and variables</code> / <code>Actions</code>. Create two new secrets:</p><ul><li><code>RELEASER_APP_ID</code>: Copy and paste your GitHub application ID (app ID) from
the <a href=#2-download-private-key>GitHub application settings page</a>.</li><li><code>RELEASER_APP_KEY</code>: Copy and paste the contents of the private key file downloaded earlier.</li></ul><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/secrets_hufa601c1709078600e70533dfd1c17f62_43876_825x825_fit_catmullrom_3.png width=825 height=181></figure><h3 id=generate-token-with-the-github-application>Generate Token with the GitHub Application</h3><p>In the release workflow, generate a token with the GitHub Application.
For this, you can use a special action, <a href=https://github.com/actions/create-github-app-token><code>actions/create-github-app-token</code></a>,
that utilizes the secrets defined in the previous step.</p><p>You can use the generated token for the repository cloning step. One can access the token using
the outputs of the token generation step. Since the repository gets cloned with the bot token,
the bot user will perform subsequent git actions.</p><figure class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:835px><img class=card-img-top src=/blog/2024/03/27/managing-github-branch-protections/workflow_huf9355079c980a05a5ac2b26815d76787_73180_825x825_fit_catmullrom_3.png width=825 height=421></figure><p>You can find the sample workflow in <a href=https://github.com/lauravuo/gh-ruleset-test/blob/main/.github/workflows/release.yml>GitHub</a>.</p><p>So, the release script can now push directly to the main branch as we use the releaser bot token and
have configured a bypass rule for the bot user in the rulesets. At the same time, other users cannot
push to the main branch but must create a PR for their changes.</p><h2 id=summary>Summary</h2><p>That&rsquo;s it! The above steps show how to automate project release workflow in GitHub Actions
with a dedicated bot user while still having repository branch protections to shield from
accidental changes and unvetted code. I hope the instructions are of use to you. I&rsquo;m always happy
to have comments and ideas for improvement; you can contact me on <a href=https://www.linkedin.com/in/lauravuorenoja/>LinkedIn</a>!</p><div style=display:flex><span><img src="https://avatars.githubusercontent.com/u/29113682?v=4%22" width=100><div>Laura</div><div><a href=https://github.com/lauravuo/ target=_blank rel="noopener noreferer"><i class="fab fa-github ml-2"></i></a>
<a href=https://www.linkedin.com/in/lauravuorenoja/ target=_blank rel="noopener noreferer"><i class="fab fa-linkedin ml-2"></i></a>
<a href=https://fosstodon.org/@lauravuo target=_blank rel="noopener noreferer"><i class="fab fa-mastodon ml-2"></i></a>
<a href=https://twitter.com/vuorenoja target=_blank rel="noopener noreferer"><i class="fab fa-twitter ml-2"></i></a></div></span></div><br><br><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2024/01/05/path-to-passwordless/ aria-label="Previous - Path to Passwordless" class="btn btn-primary"><span class=mr-1>←</span>Previous</a></li><li><a href=/blog/2024/04/06/i-want-mdl/ aria-label="Next - I want mDL!" class="btn btn-primary">Next<span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/findy-network aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2024 The Findy Agency Authors All Rights Reserved</small><p class=mt-2><a href=/about/>About Findy Agency</a></p></div></div></div></footer></div><script src=/js/deflate.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css integrity="sha512-6VMVcy7XQNyarhVuiL50FzpgCFKsyTd6YO93aaQEyET+BNaWvj0IgKR86Bf6+AmWczxAcSnL+JGjo+iStgO1gQ==" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.js integrity="sha512-b9IKj4LCNrtCPBhceRcoYOHWW/S2q9fpl7iAJlyxYpykRj1SKM7FE9+E0NEnJ8g8ni47LBr2GuX9qzg/xeuwzQ==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous onload=renderMathInElement(document.body,null)></script><script src=https://cdn.jsdelivr.net/npm/mermaid@9.2.2/dist/mermaid.min.js integrity="sha512-IX+bU+wShHqfqaMHLMrtwi4nK6W/Z+QdZoL4kPNtRxI2wCLyHPMAdl3a43Fv1Foqv4AP+aiW6hg1dcrTt3xc+Q==" crossorigin=anonymous></script>
<script src=/js/main.min.e550617e9dce4b94b8bbd911c8616f43d4f6dc24c226d2a33d51ef6cb27f783d.js integrity="sha256-5VBhfp3OS5S4u9kRyGFvQ9T23CTCJtKjPVHvbLJ/eD0=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>