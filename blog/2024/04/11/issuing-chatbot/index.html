<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Issuing Chatbot | Findy Agency</title>
<meta name=description content=" Our SSI/DID agency solution is fully symmetric, which means that our agents can be in any role simultaneously: `issuer`, `holder`, and `verifier`. However, the base-technology (`indylib`) haven't been built for symmetry. Luckily we have our own protocol engine and the tools around it allow us to build SSI services as chatbots. We have implemented our own state machine engine to develop and run these chatbot machines. "><meta property="og:url" content="https://findy-network.github.io/blog/2024/04/11/issuing-chatbot/"><meta property="og:site_name" content="Findy Agency"><meta property="og:title" content="Issuing Chatbot"><meta property="og:description" content=" Our SSI/DID agency solution is fully symmetric, which means that our agents can be in any role simultaneously: `issuer`, `holder`, and `verifier`. However, the base-technology (`indylib`) haven't been built for symmetry. Luckily we have our own protocol engine and the tools around it allow us to build SSI services as chatbots. We have implemented our own state machine engine to develop and run these chatbot machines. "><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-11T00:00:00+00:00"><meta property="og:image" content="https://findy-network.github.io/blog/2024/04/11/issuing-chatbot/cover.png"><meta itemprop=name content="Issuing Chatbot"><meta itemprop=description content=" Our SSI/DID agency solution is fully symmetric, which means that our agents can be in any role simultaneously: `issuer`, `holder`, and `verifier`. However, the base-technology (`indylib`) haven't been built for symmetry. Luckily we have our own protocol engine and the tools around it allow us to build SSI services as chatbots. We have implemented our own state machine engine to develop and run these chatbot machines. "><meta itemprop=datePublished content="2024-04-11T00:00:00+00:00"><meta itemprop=dateModified content="2024-04-11T00:00:00+00:00"><meta itemprop=wordCount content="1944"><meta itemprop=image content="https://findy-network.github.io/blog/2024/04/11/issuing-chatbot/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://findy-network.github.io/blog/2024/04/11/issuing-chatbot/cover.png"><meta name=twitter:title content="Issuing Chatbot"><meta name=twitter:description content=" Our SSI/DID agency solution is fully symmetric, which means that our agents can be in any role simultaneously: `issuer`, `holder`, and `verifier`. However, the base-technology (`indylib`) haven't been built for symmetry. Luckily we have our own protocol engine and the tools around it allow us to build SSI services as chatbots. We have implemented our own state machine engine to develop and run these chatbot machines. "><link rel=preload href=/scss/main.min.c7fba8d75c695e2a7cf37f10b188552511714d4c1645c16af7e24f7cc964a002.css as=style><link href=/scss/main.min.c7fba8d75c695e2a7cf37f10b188552511714d4c1645c16af7e24f7cc964a002.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Findy Agency</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/blog/><span>Blog</span></a></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="Findy Agency Blog" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240424the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools-li><a href=/blog/2024/04/24/the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools/ title="The Swiss Army Knife for the Agency Project, Part 3: Other GitHub Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240424the-swiss-army-knife-for-the-agency-project-part-3-other-github-tools><span>Other GitHub Tools</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240423the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github-li><a href=/blog/2024/04/23/the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github/ title="The Swiss Army Knife for the Agency Project, Part 2: Release Management with GitHub" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240423the-swiss-army-knife-for-the-agency-project-part-2-release-management-with-github><span>Release Management with GitHub</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions-li><a href=/blog/2024/04/22/the-swiss-army-knife-for-the-agency-project-part-1-github-actions/ title="The Swiss Army Knife for the Agency Project, Part 1: GitHub Actions" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240422the-swiss-army-knife-for-the-agency-project-part-1-github-actions><span>GitHub Actions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20240411issuing-chatbot-li><a href=/blog/2024/04/11/issuing-chatbot/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20240411issuing-chatbot><span class=td-sidebar-nav-active-item>Issuing Chatbot</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240406i-want-mdl-li><a href=/blog/2024/04/06/i-want-mdl/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240406i-want-mdl><span>I want mDL!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240327managing-github-branch-protections-li><a href=/blog/2024/03/27/managing-github-branch-protections/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240327managing-github-branch-protections><span>Managing GitHub Branch Protections</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20240105path-to-passwordless-li><a href=/blog/2024/01/05/path-to-passwordless/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20240105path-to-passwordless><span>Path to Passwordless</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231116test-coverage-beyond-unit-testing-li><a href=/blog/2023/11/16/test-coverage-beyond-unit-testing/ title="Test Coverage Beyond Unit Testing" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231116test-coverage-beyond-unit-testing><span>Coverage for E2E Tests</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231022how-to-write-modifiable-readable-go-code-li><a href=/blog/2023/10/22/how-to-write-modifiable-readable-go-code/ title="How To Write Modifiable & Readable Go Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231022how-to-write-modifiable-readable-go-code><span>Quality Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20231008how-to-write-performant-go-code-li><a href=/blog/2023/10/08/how-to-write-performant-go-code/ title="How To Write Performant Go Code" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20231008how-to-write-performant-go-code><span>Performant Go Code</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230823gophercon-uk-2023-li><a href=/blog/2023/08/23/gophercon-uk-2023/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230823gophercon-uk-2023><span>GopherCon UK 2023</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230622beautiful-state-machines-fsm-part-ii-li><a href=/blog/2023/06/22/beautiful-state-machines-fsm-part-ii/ title="Beautiful State-Machines - FSM Part II" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230622beautiful-state-machines-fsm-part-ii><span>Beautiful State-Machines</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230613the-agency-workshop-li><a href=/blog/2023/06/13/the-agency-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230613the-agency-workshop><span>The Agency Workshop</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now-li><a href=/blog/2023/06/09/the-time-to-build-ssi-capabilities-is-now/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230609the-time-to-build-ssi-capabilities-is-now><span>The Time to Build SSI Capabilities Is Now</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation-li><a href=/blog/2023/05/25/digital-identity-hack-part-3-introduction-to-ssi-presentation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230525digital-identity-hack-part-3-introduction-to-ssi-presentation><span>Digital Identity Hack Part 3 – Introduction to SSI Presentation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects-li><a href=/blog/2023/05/23/digital-identity-hack-part-2-panel-discussion-on-blockchain-projects/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230523digital-identity-hack-part-2-panel-discussion-on-blockchain-projects><span>Digital Identity Hack Part 2 – Panel Discussion on Blockchain Projects</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi-li><a href=/blog/2023/05/11/digital-identity-hack-unlocking-the-potential-of-ssi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230511digital-identity-hack-unlocking-the-potential-of-ssi><span>Digital Identity Hack – Unlocking the Potential of SSI</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230508deploying-with-cdk-pipeline-li><a href=/blog/2023/05/08/deploying-with-cdk-pipeline/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230508deploying-with-cdk-pipeline><span>Deploying with CDK Pipeline</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230425agencys-iac-journey-li><a href=/blog/2023/04/25/agencys-iac-journey/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230425agencys-iac-journey><span>Agency's IaC Journey</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i-li><a href=/blog/2023/03/13/no-code-ssi-chatbots-fsm-part-i/ title="No-Code SSI Chatbots - FSM Part I" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230313no-code-ssi-chatbots-fsm-part-i><span>No-Code SSI Chatbots</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers-li><a href=/blog/2023/02/06/how-to-equip-your-app-with-vc-superpowers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230206how-to-equip-your-app-with-vc-superpowers><span>How to Equip Your App with VC Superpowers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20230130getting-started-with-ssi-service-agent-development-li><a href=/blog/2023/01/30/getting-started-with-ssi-service-agent-development/ title="Getting Started with SSI Service Agent Development " class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20230130getting-started-with-ssi-service-agent-development><span>Getting Started with SSI Service Agent Development</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220930ledger-multiplexer-li><a href=/blog/2022/09/30/ledger-multiplexer/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220930ledger-multiplexer><span>Ledger Multiplexer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220927the-hyperledger-global-forum-experience-li><a href=/blog/2022/09/27/the-hyperledger-global-forum-experience/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220927the-hyperledger-global-forum-experience><span>The Hyperledger Global Forum Experience</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220829the-findy-agency-api-li><a href=/blog/2022/08/29/the-findy-agency-api/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220829the-findy-agency-api><span>The Findy Agency API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220427trust-in-your-wallet-li><a href=/blog/2022/04/27/trust-in-your-wallet/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220427trust-in-your-wallet><span>Trust in Your Wallet</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220407ssi-empowered-identity-provider-li><a href=/blog/2022/04/07/ssi-empowered-identity-provider/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220407ssi-empowered-identity-provider><span>SSI-Empowered Identity Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220314replacing-indy-sdk-li><a href=/blog/2022/03/14/replacing-indy-sdk/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220314replacing-indy-sdk><span>Replacing Indy SDK</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220305the-missing-network-layer-model-li><a href=/blog/2022/03/05/the-missing-network-layer-model/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220305the-missing-network-layer-model><span>The Missing Network Layer Model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220119fostering-interoperability-li><a href=/blog/2022/01/19/fostering-interoperability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220119fostering-interoperability><span>Fostering Interoperability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211109anchoring-chains-of-trust-li><a href=/blog/2021/11/09/anchoring-chains-of-trust/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211109anchoring-chains-of-trust><span>Anchoring Chains of Trust</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210920the-arm-adventure-on-docker-li><a href=/blog/2021/09/20/the-arm-adventure-on-docker/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210920the-arm-adventure-on-docker><span>The Arm Adventure on Docker</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210908travelogue-li><a href=/blog/2021/09/08/travelogue/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210908travelogue><span>Travelogue</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210811announcing-findy-agency-li><a href=/blog/2021/08/11/announcing-findy-agency/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210811announcing-findy-agency><span>Announcing Findy Agency</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a id=print href=/blog/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#what-problem-do-we-solve>What Problem Do We Solve?</a><ul><li><a href=#isnt-this-centralization>Isn&rsquo;t This Centralization?</a></li></ul></li><li><a href=#more-reading>More Reading</a></li><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#helpers>Helpers</a></li><li><a href=#very-important>Very Important</a></li></ul></li><li><a href=#setup-agents-and-wallets>Setup Agents And Wallets</a></li><li><a href=#use-the-issuing-service>Use The Issuing Service</a></li><li><a href=#the-sequence-diagram>The Sequence Diagram</a><ul><li></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=/blog/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Issuing Chatbot</h1><div class=lead>Our SSI/DID agency solution is fully symmetric, which means that our agents can be in any role simultaneously: <code>issuer</code>, <code>holder</code>, and <code>verifier</code>. However, the base-technology (<code>indylib</code>) haven&rsquo;t been built for symmetry. Luckily we have our own protocol engine and the tools around it allow us to build SSI services as chatbots. We have implemented our own state machine engine to develop and run these chatbot machines.</div><div class="td-byline mb-4">By <b>Harri Lainio</b> |
<time datetime=2024-04-11 class=text-body-secondary>Thursday, April 11, 2024</time></div><header class=article-meta></header><p>This post is a development story (or hands-on workshop) of how we can use an FSM
chatbot to implement SSI Services to allow any SSI/DID owner to be an issuer.
Let’s start with the result and see what the state machine looks like. As you
can see below, it’s simple, elegant, and, most importantly, easy to reason.</p><img src=/blog/2024/04/11/issuing-chatbot/fsm.svg width=1900><p><em>Issuing Service Chatbot</em><br><br></p><p>As you can see from the diagram there are two main paths. One for the <code>issuer</code> role
and one for the <code>rcvr</code> role. But the most interesting thing is that how simple the
machine is. As said, it&rsquo;s very easy to reason and understand. And that&rsquo;s the one of powers
these machines. The second one comes from the computational model of FSMs in
general, we could <a href=https://www.academia.edu/3671180/FORMAL_VERIFICATION_OF_FINITE_STATE_MACHINES>proof that they&rsquo;re correct</a>.</p><blockquote><p>Note that since our original FSM engine release we have extended our model
with <em>transient state transitions or
<a href=https://www.site.uottawa.ca/~tcl/gradtheses/mnojoumian/ThesisFiles/FinalSpec/UML/15.3.8.html>pseudostates</a></em>,
but our UML renderer doesn&rsquo;t highlight them yet. We&rsquo;ll publish an other blog
post with new features of our FSM engine later.</p></blockquote><h2 id=what-problem-do-we-solve>What Problem Do We Solve?</h2><p>The <a href=https://hyperledger-indy.readthedocs.io/en/latest/>Hyperledger Indy-based</a>
SSI system is implemented with a CL signature scheme for ZKPs. That system needs
the concept of <em>Credential Definition</em> stored in its creator&rsquo;s wallet. The
Credential Definition has an ID, which is quite similar to DID in the Indy-based
AnonCreds system. The CredDefID is public. Everyone who knows it can request
proof based on it or request to present a proof based on it.</p><p>But the CredDefID brings us some problems:</p><ol><li>How do we find a correct CredDefID when it&rsquo;s needed?</li><li>How about fully symmetric cases when everyone can simultaneously be an
issuer, a holder, and a verifier? Everyone can issue credentials and receive
proof of them in these use cases. For example, we have a use case where a
seller (anybody in a marketplace) wants to issue a receipt for the
transaction.</li></ol><p>There are other problems, but the rest are based on the same core problem.</p><p>We&rsquo;ll solve problem number 2 by using a notary-type service. We started with one
service and implemented a reference chatbot to issue credentials on behalf of a
logical issuer, aka seller. We also have implemented our version of a <em>public</em>
DID. With these two, we have solved the problem quite elegantly.</p><h3 id=isnt-this-centralization>Isn&rsquo;t This Centralization?</h3><p>In some ways, yes, but the result isn&rsquo;t more centralized than the suggested
trust registries for other or similar problems in the SSI field. In a certain
way, this model adds self-sovereignty because now everyone can issue, and
everyone can build these issuing services for their use cases.</p><h2 id=more-reading>More Reading</h2><p>Before we continue, here&rsquo;s a list of
documents and places that are helpful when playing with these:</p><ol><li><a href=https://findy-network.github.io/blog/2023/01/30/getting-started-with-ssi-service-agent-development/>Getting Started With SSI Service Agent Development</a></li><li><a href=https://findy-network.github.io/blog/2023/02/06/how-to-equip-your-app-with-vc-superpowers/>Writing SSI Apps</a></li><li><a href=https://findy-network.github.io/blog/2023/03/13/no-code-ssi-chatbots-fsm-part-i/>FSM Documentation Part I</a></li><li><a href=https://findy-network.github.io/blog/2023/06/22/beautiful-state-machines-fsm-part-ii/>FSM Documentation Part II</a></li><li><a href=https://github.com/findy-network/agency-workshop/tree/master/track1-cli#task-0-setup-environment>The Workshop Material For Our CLI Tool</a></li></ol><blockquote><p>Note that the blog post is written from self-learning material point of view.
Preferably, you should read and execute the commands it guides you to do
simultaneously.</p></blockquote><h2 id=prerequisites>Prerequisites</h2><p>Note, for now, we assume that the reader uses the local setup of the agency.
It makes it easier to follow the core agent&rsquo;s real-time logs.</p><p>Even though you have probably cloned the repo. But if not, please do it now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git clone https://github.com/findy-network/findy-agent-cli
</span></span></code></pre></div><p>Follow the material in the repo&rsquo;s readme files or the workshop material
mentioned at the beginning to get your <code>findy-agent-cli</code> CLI tool working, i.e.,
communicating with your agency.</p><h3 id=helpers>Helpers</h3><ol><li>Go to repo&rsquo;s root:</li><li>Shorter name and autocompletion:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>alias</span> <span style=color:#000>cli</span><span style=color:#ce5c00;font-weight:700>=</span>findy-agent-cli
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> ./scripts/sa-compl.sh
</span></span></code></pre></div></li></ol><blockquote><p>Document for now on assumes that CLI tool is named to <code>cli</code>.</p></blockquote><h3 id=very-important>Very Important</h3><p>If you create new wallets directly with the CLI tool, make sure that auto-accept
mode is ON for the agent. The check it <strong>after</strong> the <code>cli agent ping</code> works:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cli agent mode-cmd -r
</span></span></code></pre></div><blockquote><p>Tip, if you have problems with CLI commands check your <code>FCLI_</code> prefixed envs.</p></blockquote><p>The result should be AUTO_ACCEPT. Note that allocation scripts do this automatically.</p><blockquote><p>Chatbots work even when auto-accept isn&rsquo;t ON. They can written to make
decisions to decline or acknowledge presented proofs, for example.</p></blockquote><h2 id=setup-agents-and-wallets>Setup Agents And Wallets</h2><p>It would be best to have at least three wallets and their agents up and running.
Inside the <code>findy-agent-cli</code> repo, you have <code>scrpits/fullstack</code> directory. Let&rsquo;s
name it a tool root for the rest of the documentation. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>MY_ROOT</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>`</span><span style=color:#204a87>pwd</span><span style=color:#4e9a06>`</span>
</span></span></code></pre></div><p>Follow the workshop documentation on how to allocate new agents with their
wallets.</p><p>Allocate the following agents (actual commands and the script calls follow):</p><ol><li><code>issuing</code> will be the issuing service</li><li><code>seller</code>, will be a seller, aka logical issuer</li><li><code>buyer</code> will be a buyer.</li><li><code>verifier</code> will be a verifier for the VC. (Usage is out scoped from this document.)</li></ol><p>Here&rsquo;s an example of how you could</p><ol><li>allocate the agents,</li><li>have access to FSM files by making links,</li><li>create schema and credential definition (done in <code>issuing</code>),</li><li>create DIDComm connections between <code>issuing</code>, <code>seller</code>, and <code>buyer</code> <em>where
the last is done in this phase just for testing the environment</em>. During the
service integration (e.g. marketplace app) to the app invitation or command
to connect with <sessionid>is sent in its own step during the service use.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>cd</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$MY_ROOT</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>make-play-agent.sh issuing seller buyer verifier
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> play/issuing
</span></span><span style=display:flex><span>ln -s ../../fsm/issuing-service-f-fsm.yaml
</span></span><span style=display:flex><span>ln -s ../../fsm/issuing-service-b-fsm.yaml
</span></span><span style=display:flex><span>open <span style=color:#4e9a06>`</span>cli bot uml issuing-service-f-fsm.yaml<span style=color:#4e9a06>`</span> <span style=color:#8f5902;font-style:italic># UML rendering</span>
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> ./new-schema
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> ./new-cred-def
</span></span><span style=display:flex><span>./invitation <span style=color:#000;font-weight:700>|</span> ../seller/connect
</span></span><span style=display:flex><span>./invitation <span style=color:#000;font-weight:700>|</span> ../buyer/connect
</span></span></code></pre></div><p>Optionally store <em>a public DID</em> of the <em>Issuing Service Chatbot</em>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PUB_DID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>./pub-did print<span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><blockquote><p>Note! Leave this terminal open and do not enter new commands to it yet.</p></blockquote><blockquote><p>Note! <code>source ./new-cred-def</code> initializes <code>FCLI_CRED_DEF_ID</code> environment
variable. The <code>issuing-service-f-fsm.yaml</code> file references to this variable,
i.e. it&rsquo;s mandatory, <em>or</em> you could hard-code the <em>credential definition
value</em> to your <code>issuing-service-f-fsm.yaml</code>.</p></blockquote><h2 id=use-the-issuing-service>Use The Issuing Service</h2><ol><li>open 2 separated terminals <code>A</code> and <code>B</code> (see the workshop material on how to init
envs) to work as a <code>seller</code>, leave them to be.</li><li>open 2 separated terminals <code>A</code> and <code>B</code> (see the workshop material on how to init
envs) to work as a <code>buyer</code>, leave them to be.</li><li>go back to the previous <code>issuing</code> terminal and start the chatbot:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cli bot start --service-fsm issuing-service-b-fsm.yaml issuing-service-f-fsm.yaml -v<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div></li><li>go back to the <code>seller</code> terminal <code>A</code> and enter a command: <code>cli bot read</code>.
This is a read-only terminal window for the chatbot&rsquo;s responses.</li><li>go back to the <code>seller</code> terminal <code>B</code> and enter <code>cli bot chat</code>. This is a
write-only terminal window to send chat messages.<ol><li>(optional: enter &lsquo;help&rsquo; to get used to what&rsquo;s available)</li><li>enter your session ID, select something easy like &lsquo;SID_1&rsquo;</li><li>enter the text &lsquo;issuer&rsquo; that&rsquo;s our current <code>role</code></li><li>enter your attributes data value for credential, select something easy to
remember during verfication</li></ol></li><li>go back to the <code>buyer</code> terminal <code>A</code> and enter <code>cli bot read</code>. This is a read-only
terminal window for the chatbot&rsquo;s responses.</li><li>go back to the <code>buyer</code> terminal <code>B</code> and enter <code>cli bot chat</code>. This is a write-only
terminal window to send chat messages.<ol><li>(optional: enter &lsquo;help&rsquo; to get some reminders)</li><li>enter your previous session ID, it was something easy like &lsquo;SID_1&rsquo;</li><li>enter the text &lsquo;rcvr&rsquo;, it&rsquo;s your <code>role</code> now</li></ol></li><li>see the <code>Buyer</code>&rsquo;s <code>A</code> terminal (<code>cli bot read</code> command running); the results should be
that the credential is issued for the <code>Buyer</code>.</li><li>go to both <code>B</code> terminals and enter some text to move FSM instances to the <code>start-again</code> state.</li><li>it&rsquo;s <em>optional</em>; you could rerun it with the same players.</li></ol><blockquote><p>Tip, when you started the <em>Issuing Service Chatbot</em> with <code>-v=1</code> you could
monitor it&rsquo;s state transitions in real-time.</p></blockquote><h2 id=the-sequence-diagram>The Sequence Diagram</h2><p>Notes about the current implementation:</p><ul><li>only one attribute value schema is implemented. Start with that and add
cases where more attributes can be entered later. (Homework)</li><li>every message sends a <code>basic_message</code> reply, which usually starts with <code>ACK</code> string. See
the <code>YAML</code> file for more information. The reply messages aren&rsquo;t drawn to the
sequence diagram below to keep it as simple as possible.</li><li>you can render state machines to UML:<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>open <span style=color:#4e9a06>`</span>cli bot uml issuing-service-f-fsm.yaml<span style=color:#4e9a06>`</span> <span style=color:#8f5902;font-style:italic># give correct FSM file</span>
</span></span></code></pre></div>We have UML rendered state machine diagram in the beginning of this post.</li></ul><pre class=mermaid>sequenceDiagram
    autonumber

    participant Seller

    %% -- box won&#39;t work on hugo, or when this machine is running it --
    %% box Issuing Service
    participant IssuerFSM
    participant BackendFSM
    participant RcvrFSM
    %% end

    participant Buyer

    Seller -) IssuerFSM: &#39;session_id&#39; (GUID)
    Seller -) IssuerFSM: issuer = role
    loop Schemas attributes
    Seller -) IssuerFSM: &#39;attribute_value&#39;
    end

    alt Send thru existing connection 
    Seller -) Buyer: &#39;session_id&#39; (same as above, design how app knows that this is a command)
    end

    Buyer -) RcvrFSM: &#39;session_id&#39;
    Buyer -) RcvrFSM: rcvr = role

    RcvrFSM -) BackendFSM: receiver_arriwed
    BackendFSM -) IssuerFSM: rcvr_arriwed
    loop Schemas attributes
    IssuerFSM -) BackendFSM: &#39;attribute_value&#39;
    BackendFSM -) RcvrFSM: &#39;attribute_value&#39;
    end
    IssuerFSM -) BackendFSM: attributes done (not implemented, one attrib)
    BackendFSM -) RcvrFSM: attributes done (not implemented, one attrib)

    RcvrFSM -) Buyer: CREDENTIAL ISSUING PROTOCOL</pre><h4 id=pre-steps-not-in-the-diagram>Pre-steps (not in the diagram)</h4><ol><li>We can generate a public DID for the <em>Issuing Service Chatbot</em>.<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#204a87>cd</span> play/issuing <span style=color:#8f5902;font-style:italic># or where your bot is</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PUB_DID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>./pub-did print<span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div></li><li>Save this <code>PUB_DID</code> to your app&rsquo;s configuration. It&rsquo;s where <em>Issuing Service
Chatbot</em> can be found when needed. Note, <code>PUB_DID</code> is a URL which returns a
new invitation on every load. You can treat is as a URL template:<pre tabindex=0><code>http://localhost:8080/dyn?did=8NCqkhnNjeTwMmK68DHDPx&amp;label=&lt;you_ad_number&gt;
</code></pre>You can enter your case specific data like ad number to the <code>label</code> arg.</li></ol><h4 id=steps>Steps</h4><ol><li>Actual <em>Seller</em> role or app implementation for the role generates a sessionID
(GUID) and sends it to <em>Issuing Service Chatbot</em> as a <code>basic_message</code>.</li><li>The <em>Seller</em> role is a logical issuer, so it sends the <code>issuer</code> string as a
<code>basic_message</code> to the <em>Issuer FSM</em> instance.</li><li>The <em>Seller</em> role sends a &lt;attr_val> (case specific in your schema) as a
<code>basic_message</code>.</li><li>The <em>Seller</em> role sends the same sessionID directly to the <em>buyer</em> role. The
communication channel can be their existing DIDComm connection or something
else, but the <em>buyer</em> needs to know how to react to that line if it&rsquo;s a
<code>basic_message</code>.</li><li>The <em>Buyer</em> role or app implementation for the role sends the received
<code>sessionID</code> to the chatbot, i.e., joins the same session.</li><li>The <em>Buyer</em> role sends the <code>rcvr</code> word to the chatbot to make explicit role
selection. (We could leave this out in some version of FSM implementation
and rely only on the order of the messages, but this allows us to understand
better and keep things open for future extensions.)</li><li>The <em>Rcvr FSM</em> instance has now got the actual credential holder
(Buyer/Receiver) and it sends a <code>receiver_arriwed</code> string to the Backend FSM.</li><li>The <em>Backend FSM</em> sends a <code>rcvr_arriwed</code> to the <em>Issuer FSM</em> as a
<code>basic_message</code>.</li><li>Now the <em>Issuer FSM</em> loops thru all previously received (from <em>Seller</em>)
attribute values and sends them to the <em>Backend FSM</em>.</li><li>The <em>Backend FSM</em> sends the attribute values to the <em>Rcvr FSM</em> as a
<code>basic_messages</code></li><li><strong>Optional for the future</strong>: if there would be more attributes than one, this
would be the place to send the information that all attributes are sent to
the Backend FSM. Another way to implement these state machines would be to add
information to both <em>Issuing</em> and <em>Receiving FSMs</em> how many attributes there
are, and receiving states would be declared to rely on that knowledge.</li><li><strong>Optional</strong>: see the previous step. The <em>Backend</em> FSM works as a forwarder
for all of the cases where the issuing and the receiving FSM instances need
to communicate with each other through the chatbot service.</li><li>Finally the <em>RcvrFSM</em> executes <strong>credential issuing protocol</strong>.</li></ol><h2 id=conclusion>Conclusion</h2><p>You have been blown away by how easy it is to implement these FSM-based
chatbots, haven’t you? The Issuing Service is only one example of the potential
of the FSM chatbots. We are excited to see what else you end up building. When
doing so, please send your questions, comments, and feedback to our team. Let’s
make this better—together.</p><br><div style=display:flex><span><img src="https://avatars.githubusercontent.com/u/11439212?v=4" width=100><div>Harri</div><div><a href=https://github.com/lainio/ target=_blank rel="noopener noreferer"><i class="fab fa-github ml-2"></i></a>
<a href=https://www.linkedin.com/in/harrilainio/ target=_blank rel="noopener noreferer"><i class="fab fa-linkedin ml-2"></i></a>
<a href=https://twitter.com/harrilainio target=_blank rel="noopener noreferer"><i class="fab fa-twitter ml-2"></i></a></div></span></div><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2024/04/06/i-want-mdl/ aria-label="Previous - I want mDL!" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/blog/2024/04/22/the-swiss-army-knife-for-the-agency-project-part-1-github-actions/ aria-label="Next - The Swiss Army Knife for the Agency Project, Part 1: GitHub Actions" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/findy-network aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>The Findy Agency Authors</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><p class="td-footer__about mt-2"><a href=/about/>About Findy Agency</a></p></div></div></div></footer></div><script src=/js/deflate.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css integrity="sha512-r2+FkHzf1u0+SQbZOoIz2RxWOIWfdEzRuYybGjzKq18jG9zaSfEy9s3+jMqG/zPtRor/q4qaUCYQpmSjTw8M+g==" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js integrity="sha512-INps9zQ2GUEMCQD7xiZQbGUVnqnzEvlynVy6eqcTcHN4+aQiLo9/uaQqckDpdJ8Zm3M0QBs+Pktg4pz0kEklUg==" crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js integrity="sha512-YJVxTjqttjsU3cSvaTRqsSl0wbRgZUNF+NGGCgto/MUbIvaLdXQzGTCQu4CvyJZbZctgflVB0PXw9LLmTWm5/w==" crossorigin=anonymous onload=renderMathInElement(document.body,null)></script><script type=module async>
  import mermaid from "https:\/\/cdn.jsdelivr.net\/npm\/mermaid@latest\/dist\/mermaid.esm.min.mjs";

  (function ($) {
    if ($('.mermaid').length == 0) {
      mermaid.initialize({ startOnLoad: false });
      return;
    }

    var params = {"enable":true,"theme":"default"};

    
    
    var norm = function (defaultConfig, params) {
      var result = {};
      for (const key in defaultConfig) {
        const keyLower = key.toLowerCase();
        if (defaultConfig.hasOwnProperty(key) && params.hasOwnProperty(keyLower)) {
          if (typeof defaultConfig[key] === "object") {
            result[key] = norm(defaultConfig[key], params[keyLower]);
          } else {
            result[key] = params[keyLower];
          }
        }
      }
      return result;
    };

    var settings = norm(mermaid.mermaidAPI.defaultConfig, params);
    settings.startOnLoad = true;
    if ($('html[data-bs-theme="dark"]').length) {
      settings.theme = 'dark';
    }
    mermaid.initialize(settings);

    
    const lightDarkModeThemeChangeHandler = function (mutationsList, observer) {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
          
          
          
          location.reload();
        }
      }
    };

    const observer = new MutationObserver(lightDarkModeThemeChangeHandler);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-bs-theme']
    });
    

  })(jQuery);
</script><script src=/js/main.min.707e26db94486c03ddc6847e7aea1444dc611101bd171e20143f53029c146108.js integrity="sha256-cH4m25RIbAPdxoR+euoURNxhEQG9Fx4gFD9TApwUYQg=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>